{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "cea52e63",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "a0e324bf",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-08-16T10:34:22.185671Z",
     "iopub.status.busy": "2022-08-16T10:34:22.185458Z",
     "iopub.status.idle": "2022-08-16T10:34:25.069264Z",
     "shell.execute_reply": "2022-08-16T10:34:25.068715Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/jesper/src/GPflow/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "/home/jesper/src/GPflow/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.inheritance.inherit_check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import reduce_in_tests\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "323f705d",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "7a85067e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-08-16T10:34:25.071665Z",
     "iopub.status.busy": "2022-08-16T10:34:25.071363Z",
     "iopub.status.idle": "2022-08-16T10:34:25.074026Z",
     "shell.execute_reply": "2022-08-16T10:34:25.073592Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b44017d6",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "22975024",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-08-16T10:34:25.075902Z",
     "iopub.status.busy": "2022-08-16T10:34:25.075756Z",
     "iopub.status.idle": "2022-08-16T10:34:25.078083Z",
     "shell.execute_reply": "2022-08-16T10:34:25.077726Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = reduce_in_tests(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "78f37633",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-08-16T10:34:25.079812Z",
     "iopub.status.busy": "2022-08-16T10:34:25.079667Z",
     "iopub.status.idle": "2022-08-16T10:34:25.156217Z",
     "shell.execute_reply": "2022-08-16T10:34:25.155744Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f6e185bab00>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "4cdfa51b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-08-16T10:34:25.158140Z",
     "iopub.status.busy": "2022-08-16T10:34:25.157935Z",
     "iopub.status.idle": "2022-08-16T10:34:25.224951Z",
     "shell.execute_reply": "2022-08-16T10:34:25.224475Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/jesper/src/GPflow/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "2022-08-16 11:34:25.186285: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:975] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n",
      "2022-08-16 11:34:25.189410: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcusolver.so.11'; dlerror: libcusolver.so.11: cannot open shared object file: No such file or directory\n",
      "2022-08-16 11:34:25.189948: W tensorflow/core/common_runtime/gpu/gpu_device.cc:1850] Cannot dlopen some GPU libraries. Please make sure the missing libraries mentioned above are installed properly if you would like to use GPU. Follow the guide at https://www.tensorflow.org/install/gpu for how to download and setup the required libraries for your platform.\n",
      "Skipping registering GPU devices...\n",
      "2022-08-16 11:34:25.190545: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f6e1860a470&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value  </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0    </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]</td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0    </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.01   </td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f6e1860a470>\n",
       "\u2552\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2564\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2564\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2564\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2564\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2564\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2564\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2564\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2555\n",
       "\u2502 name                               \u2502 class     \u2502 transform        \u2502 prior   \u2502 trainable   \u2502 shape   \u2502 dtype   \u2502 value   \u2502\n",
       "\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n",
       "\u2502 GPR.kernel.kernels[0].variance     \u2502 Parameter \u2502 Softplus         \u2502         \u2502 True        \u2502 ()      \u2502 float64 \u2502 1.0     \u2502\n",
       "\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n",
       "\u2502 GPR.kernel.kernels[0].lengthscales \u2502 Parameter \u2502 Softplus         \u2502         \u2502 True        \u2502 (2,)    \u2502 float64 \u2502 [1. 2.] \u2502\n",
       "\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n",
       "\u2502 GPR.kernel.kernels[1].variance     \u2502 Parameter \u2502 Softplus         \u2502         \u2502 True        \u2502 ()      \u2502 float64 \u2502 1.0     \u2502\n",
       "\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n",
       "\u2502 GPR.likelihood.variance            \u2502 Parameter \u2502 Softplus + Shift \u2502         \u2502 True        \u2502 ()      \u2502 float64 \u2502 0.01    \u2502\n",
       "\u2558\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2567\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2567\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2567\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2567\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2567\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2567\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2567\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255b"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "db27eedd",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-08-16T10:34:25.226881Z",
     "iopub.status.busy": "2022-08-16T10:34:25.226723Z",
     "iopub.status.idle": "2022-08-16T10:34:25.354769Z",
     "shell.execute_reply": "2022-08-16T10:34:25.354301Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fcae4a91",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "6b52f6ea",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-08-16T10:34:25.356874Z",
     "iopub.status.busy": "2022-08-16T10:34:25.356687Z",
     "iopub.status.idle": "2022-08-16T10:34:25.369537Z",
     "shell.execute_reply": "2022-08-16T10:34:25.369029Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "bafc7f86",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "0e8abc4b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-08-16T10:34:25.371868Z",
     "iopub.status.busy": "2022-08-16T10:34:25.371666Z",
     "iopub.status.idle": "2022-08-16T10:34:25.374536Z",
     "shell.execute_reply": "2022-08-16T10:34:25.374098Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "2ba03a88",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-08-16T10:34:25.376236Z",
     "iopub.status.busy": "2022-08-16T10:34:25.376087Z",
     "iopub.status.idle": "2022-08-16T10:34:26.932073Z",
     "shell.execute_reply": "2022-08-16T10:34:26.930410Z"
    }
   },
   "outputs": [],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dffe0802",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "addbbbf8",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "f202d2e3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-08-16T10:34:26.951437Z",
     "iopub.status.busy": "2022-08-16T10:34:26.951117Z",
     "iopub.status.idle": "2022-08-16T10:34:26.957581Z",
     "shell.execute_reply": "2022-08-16T10:34:26.956715Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "74e29fcd",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "09dc2af4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-08-16T10:34:26.961321Z",
     "iopub.status.busy": "2022-08-16T10:34:26.961016Z",
     "iopub.status.idle": "2022-08-16T10:34:28.287753Z",
     "shell.execute_reply": "2022-08-16T10:34:28.287162Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d8c98c1b",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "bc9d5938",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "bdf7bdf2",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-08-16T10:34:28.290059Z",
     "iopub.status.busy": "2022-08-16T10:34:28.289870Z",
     "iopub.status.idle": "2022-08-16T10:34:28.302574Z",
     "shell.execute_reply": "2022-08-16T10:34:28.302040Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "28d05c72",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-08-16T10:34:28.304551Z",
     "iopub.status.busy": "2022-08-16T10:34:28.304392Z",
     "iopub.status.idle": "2022-08-16T10:34:30.216424Z",
     "shell.execute_reply": "2022-08-16T10:34:30.215899Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68100085183153\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-3.34238737e-04, -4.16767372e-04,  6.72830705e-05,  2.16370933e-07,\n",
       "        8.76085403e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 44\n",
       "      nit: 41\n",
       "     njev: 44\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  1.99416732,   1.80228969,   0.1814142 , -17.56521416,\n",
       "        -4.53839972])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}