
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>gpflow.experimental.check_shapes &#8212; GPflow 2.6.1 documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/pydata-custom.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="gpflow.experimental.check_shapes.accessors" href="accessors/index.html" />
    <link rel="prev" title="gpflow.experimental" href="../index.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../../../index.html">
  
  
  
  
    <img src="../../../../_static/gpflow_logo.svg" class="logo__image only-light" alt="Logo image">
    <img src="../../../../_static/gpflow_logo.svg" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../intro.html">
  Introduction
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../manual.html">
  GPflow manual
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../notebooks/intro_to_gpflow2.html">
  GPflow with TensorFlow 2
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../notebooks_file.html">
  Notebooks
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../derivations.html">
  Derivations
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../../index.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../bibliography.html">
  Bibliography
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        2.6.1  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables api/gpflow/experimental/check_shapes/index and {'json_url': 'https://gpflow.github.io/GPflow/versions.json', 'version_match': '2.6.1'}.
-->

<script type="text/javascript">
// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "api/gpflow/experimental/check_shapes/index.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://gpflow.github.io/GPflow/versions.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "api/gpflow/experimental/check_shapes/index.html";
        let btn = document.getElementById("version_switcher_button");
        // Set empty strings by default so that these attributes exist and can be used in CSS selectors
        btn.dataset["activeVersionName"] = "";
        btn.dataset["activeVersion"] = "";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            // Add dataset values for the version and name in case people want
            // to apply CSS styling based on this information.
            node.dataset["versionName"] = entry.name;
            node.dataset["version"] = entry.version;

            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's  variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "2.6.1") {
                node.classList.add("active");
                btn.innerText = btn.dataset["activeVersionName"] = entry.name;
                btn.dataset["activeVersion"] = entry.version;
            }
        });
    });
})();
</script>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../base/index.html">
   gpflow.base
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../conditionals/index.html">
   gpflow.conditionals
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../conditionals/util/index.html">
     gpflow.conditionals.util
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../config/index.html">
   gpflow.config
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../covariances/index.html">
   gpflow.covariances
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../expectations/index.html">
   gpflow.expectations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../expectations/quadratures/index.html">
     gpflow.expectations.quadratures
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   gpflow.experimental
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active has-children">
    <a class="current reference internal" href="#">
     gpflow.experimental.check_shapes
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="accessors/index.html">
       gpflow.experimental.check_shapes.accessors
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="argument_ref/index.html">
       gpflow.experimental.check_shapes.argument_ref
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="bool_specs/index.html">
       gpflow.experimental.check_shapes.bool_specs
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="checker_context/index.html">
       gpflow.experimental.check_shapes.checker_context
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="decorator/index.html">
       gpflow.experimental.check_shapes.decorator
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="error_contexts/index.html">
       gpflow.experimental.check_shapes.error_contexts
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="exceptions/index.html">
       gpflow.experimental.check_shapes.exceptions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="parser/index.html">
       gpflow.experimental.check_shapes.parser
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shapes/index.html">
       gpflow.experimental.check_shapes.shapes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="specs/index.html">
       gpflow.experimental.check_shapes.specs
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/index.html">
     gpflow.experimental.utils
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../functions/index.html">
   gpflow.functions
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../inducing_variables/index.html">
   gpflow.inducing_variables
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../inducing_variables/inducing_variables/index.html">
     gpflow.inducing_variables.inducing_variables
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../kernels/index.html">
   gpflow.kernels
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../kernels/base/index.html">
     gpflow.kernels.base
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../kullback_leiblers/index.html">
   gpflow.kullback_leiblers
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../likelihoods/index.html">
   gpflow.likelihoods
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../likelihoods/utils/index.html">
     gpflow.likelihoods.utils
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../logdensities/index.html">
   gpflow.logdensities
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../models/index.html">
   gpflow.models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../models/cglb/index.html">
     gpflow.models.cglb
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../models/gpr/index.html">
     gpflow.models.gpr
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../models/sgpr/index.html">
     gpflow.models.sgpr
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../models/svgp/index.html">
     gpflow.models.svgp
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../models/util/index.html">
     gpflow.models.util
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../models/vgp/index.html">
     gpflow.models.vgp
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../monitor/index.html">
   gpflow.monitor
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../optimizers/index.html">
   gpflow.optimizers
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../optimizers/natgrad/index.html">
     gpflow.optimizers.natgrad
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../posteriors/index.html">
   gpflow.posteriors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../probability_distributions/index.html">
   gpflow.probability_distributions
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../quadrature/index.html">
   gpflow.quadrature
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../quadrature/gauss_hermite/index.html">
     gpflow.quadrature.gauss_hermite
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../type_flags/index.html">
   gpflow.type_flags
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../utilities/index.html">
   gpflow.utilities
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../utilities/ops/index.html">
     gpflow.utilities.ops
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../utilities/parameter_or_function/index.html">
     gpflow.utilities.parameter_or_function
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#speed-and-interactions-with-tf-function">
   Speed, and interactions with
   <cite>
    tf.function
   </cite>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#best-effort-checking">
   Best-effort checking
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-specification">
   Check specification
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#argument-specification">
     Argument specification
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#shape-specification">
     Shape specification
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#condition-specification">
     Condition specification
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#note-specification">
     Note specification
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#shape-reuse">
   Shape reuse
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#class-inheritance">
     Class inheritance
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#functional-programming">
     Functional programming
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-reuse-of-shapes">
     Other reuse of shapes
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#checking-intermediate-results">
   Checking intermediate results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#checking-shapes-without-a-decorator">
   Checking shapes without a decorator
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#documenting-shapes">
   Documenting shapes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#supported-types">
   Supported types
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#shapes-of-custom-types">
     Shapes of custom types
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modules">
   Modules
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#classes">
   Classes
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-docstringformat">
     gpflow.experimental.check_shapes.DocstringFormat
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.DocstringFormat">
       <code class="docutils literal notranslate">
        <span class="pre">
         DocstringFormat
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.DocstringFormat.NONE">
         <code class="docutils literal notranslate">
          <span class="pre">
           DocstringFormat.NONE
          </span>
         </code>
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.DocstringFormat.SPHINX">
         <code class="docutils literal notranslate">
          <span class="pre">
           DocstringFormat.SPHINX
          </span>
         </code>
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-errorcontext">
     gpflow.experimental.check_shapes.ErrorContext
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.ErrorContext">
       <code class="docutils literal notranslate">
        <span class="pre">
         ErrorContext
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.ErrorContext.print">
         <code class="docutils literal notranslate">
          <span class="pre">
           ErrorContext.print()
          </span>
         </code>
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-shapechecker">
     gpflow.experimental.check_shapes.ShapeChecker
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.ShapeChecker">
       <code class="docutils literal notranslate">
        <span class="pre">
         ShapeChecker
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.ShapeChecker.add_context">
         <code class="docutils literal notranslate">
          <span class="pre">
           ShapeChecker.add_context()
          </span>
         </code>
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.ShapeChecker.check_shape">
         <code class="docutils literal notranslate">
          <span class="pre">
           ShapeChecker.check_shape()
          </span>
         </code>
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.ShapeChecker.check_shapes">
         <code class="docutils literal notranslate">
          <span class="pre">
           ShapeChecker.check_shapes()
          </span>
         </code>
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-shapecheckingstate">
     gpflow.experimental.check_shapes.ShapeCheckingState
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.ShapeCheckingState">
       <code class="docutils literal notranslate">
        <span class="pre">
         ShapeCheckingState
        </span>
       </code>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.ShapeCheckingState.DISABLED">
         <code class="docutils literal notranslate">
          <span class="pre">
           ShapeCheckingState.DISABLED
          </span>
         </code>
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.ShapeCheckingState.EAGER_MODE_ONLY">
         <code class="docutils literal notranslate">
          <span class="pre">
           ShapeCheckingState.EAGER_MODE_ONLY
          </span>
         </code>
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.ShapeCheckingState.ENABLED">
         <code class="docutils literal notranslate">
          <span class="pre">
           ShapeCheckingState.ENABLED
          </span>
         </code>
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#functions">
   Functions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-check-shape">
     gpflow.experimental.check_shapes.check_shape
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.check_shape">
       <code class="docutils literal notranslate">
        <span class="pre">
         check_shape()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-check-shapes">
     gpflow.experimental.check_shapes.check_shapes
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.check_shapes">
       <code class="docutils literal notranslate">
        <span class="pre">
         check_shapes()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-disable-check-shapes">
     gpflow.experimental.check_shapes.disable_check_shapes
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.disable_check_shapes">
       <code class="docutils literal notranslate">
        <span class="pre">
         disable_check_shapes()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-get-check-shapes">
     gpflow.experimental.check_shapes.get_check_shapes
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.get_check_shapes">
       <code class="docutils literal notranslate">
        <span class="pre">
         get_check_shapes()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-get-enable-check-shapes">
     gpflow.experimental.check_shapes.get_enable_check_shapes
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.get_enable_check_shapes">
       <code class="docutils literal notranslate">
        <span class="pre">
         get_enable_check_shapes()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-get-enable-function-call-precompute">
     gpflow.experimental.check_shapes.get_enable_function_call_precompute
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.get_enable_function_call_precompute">
       <code class="docutils literal notranslate">
        <span class="pre">
         get_enable_function_call_precompute()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-get-rewrite-docstrings">
     gpflow.experimental.check_shapes.get_rewrite_docstrings
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.get_rewrite_docstrings">
       <code class="docutils literal notranslate">
        <span class="pre">
         get_rewrite_docstrings()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-get-shape">
     gpflow.experimental.check_shapes.get_shape
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.get_shape">
       <code class="docutils literal notranslate">
        <span class="pre">
         get_shape()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-get-shape-checker">
     gpflow.experimental.check_shapes.get_shape_checker
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.get_shape_checker">
       <code class="docutils literal notranslate">
        <span class="pre">
         get_shape_checker()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-inherit-check-shapes">
     gpflow.experimental.check_shapes.inherit_check_shapes
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.inherit_check_shapes">
       <code class="docutils literal notranslate">
        <span class="pre">
         inherit_check_shapes()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-register-get-shape">
     gpflow.experimental.check_shapes.register_get_shape
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.register_get_shape">
       <code class="docutils literal notranslate">
        <span class="pre">
         register_get_shape()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-set-enable-check-shapes">
     gpflow.experimental.check_shapes.set_enable_check_shapes
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.set_enable_check_shapes">
       <code class="docutils literal notranslate">
        <span class="pre">
         set_enable_check_shapes()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-set-enable-function-call-precompute">
     gpflow.experimental.check_shapes.set_enable_function_call_precompute
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.set_enable_function_call_precompute">
       <code class="docutils literal notranslate">
        <span class="pre">
         set_enable_function_call_precompute()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gpflow-experimental-check-shapes-set-rewrite-docstrings">
     gpflow.experimental.check_shapes.set_rewrite_docstrings
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gpflow.experimental.check_shapes.set_rewrite_docstrings">
       <code class="docutils literal notranslate">
        <span class="pre">
         set_rewrite_docstrings()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <section id="gpflow-experimental-check-shapes">
<h1>gpflow.experimental.check_shapes<a class="headerlink" href="#gpflow-experimental-check-shapes" title="Permalink to this heading">#</a></h1>
<span class="target" id="module-gpflow.experimental.check_shapes"></span><p>A library for annotating and checking the shapes of tensors.</p>
<p>The main entry point is <a class="reference internal" href="#gpflow.experimental.check_shapes.check_shapes" title="gpflow.experimental.check_shapes.check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_shapes()</span></code></a>.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="kn">from</span> <span class="nn">gpflow.experimental.check_shapes</span> <span class="kn">import</span> <span class="n">check_shapes</span>

<span class="nd">@tf</span><span class="o">.</span><span class="n">function</span>
<span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;features: [batch..., n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;weights: [n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">linear_model</span><span class="p">(</span><span class="n">features</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;...i,i -&gt; ...&quot;</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</pre></div>
</div>
<section id="speed-and-interactions-with-tf-function">
<h2>Speed, and interactions with <cite>tf.function</cite><a class="headerlink" href="#speed-and-interactions-with-tf-function" title="Permalink to this heading">#</a></h2>
<p>Shape checking has some performance impact. Shape checking can be disabled to help alleviate this.
Shape checking can be set to one of three different states:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ENABLED</span></code>. Shapes are checked wherever they can be.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EAGER_MODE_ONLY</span></code>. Shapes are not checked within anything wrapped in <code class="xref py py-func docutils literal notranslate"><span class="pre">tf.function()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DISABLED</span></code>. Shapes are never checked.</p></li>
</ul>
<p>The state can be set with <a class="reference internal" href="#gpflow.experimental.check_shapes.set_enable_check_shapes" title="gpflow.experimental.check_shapes.set_enable_check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">set_enable_check_shapes()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">set_enable_check_shapes</span><span class="p">(</span><span class="n">ShapeCheckingState</span><span class="o">.</span><span class="n">DISABLED</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively you can use <a class="reference internal" href="#gpflow.experimental.check_shapes.disable_check_shapes" title="gpflow.experimental.check_shapes.disable_check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">disable_check_shapes()</span></code></a> to disable shape checking in smaller scopes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">disable_check_shapes</span><span class="p">():</span>
    <span class="n">performance_sensitive_function</span><span class="p">()</span>
</pre></div>
</div>
<p>Beware that any function declared while shape checking is disabled, will continue not to check
shapes, even if shape checking is otherwise enabled again.</p>
<p>The default state is <code class="docutils literal notranslate"><span class="pre">EAGER_MODE_ONLY</span></code>; which is appropriate for smaller project, experiments, and
notebooks. Write and debug your code in eager mode, and add <code class="xref py py-func docutils literal notranslate"><span class="pre">tf.function()</span></code> when you believe
your code is correct and you want it to run fast. For larger project you probably want to modify
this setting. In particular you may want to enable all shape checks in your unit tests. If you use
<a class="reference external" href="https://docs.pytest.org/">pytest</a> you can do this by updating your root <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">enable_shape_checks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
    <span class="n">old_enable</span> <span class="o">=</span> <span class="n">get_enable_check_shapes</span><span class="p">()</span>
    <span class="n">old_rewrite_docstrings</span> <span class="o">=</span> <span class="n">get_rewrite_docstrings</span><span class="p">()</span>
    <span class="n">old_function_call_precompute</span> <span class="o">=</span> <span class="n">get_enable_function_call_precompute</span><span class="p">()</span>
    <span class="n">set_enable_check_shapes</span><span class="p">(</span><span class="n">ShapeCheckingState</span><span class="o">.</span><span class="n">ENABLED</span><span class="p">)</span>
    <span class="n">set_rewrite_docstrings</span><span class="p">(</span><span class="n">DocstringFormat</span><span class="o">.</span><span class="n">SPHINX</span><span class="p">)</span>
    <span class="n">set_enable_function_call_precompute</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">set_enable_function_call_precompute</span><span class="p">(</span><span class="n">old_function_call_precompute</span><span class="p">)</span>
    <span class="n">set_rewrite_docstrings</span><span class="p">(</span><span class="n">old_rewrite_docstrings</span><span class="p">)</span>
    <span class="n">set_enable_check_shapes</span><span class="p">(</span><span class="n">old_enable</span><span class="p">)</span>
</pre></div>
</div>
<p>If shape checking is set to <code class="docutils literal notranslate"><span class="pre">ENABLED</span></code> and your code is wrapped in <code class="xref py py-func docutils literal notranslate"><span class="pre">tf.function()</span></code> shape checks
are performed while tracing graphs, but <em>not</em> compiled into the actual graphs.  This is considered a
feature as that means that <a class="reference internal" href="#gpflow.experimental.check_shapes.check_shapes" title="gpflow.experimental.check_shapes.check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_shapes()</span></code></a> doesn’t impact the execution speed of your functions
after they have been compiled.</p>
</section>
<section id="best-effort-checking">
<h2>Best-effort checking<a class="headerlink" href="#best-effort-checking" title="Permalink to this heading">#</a></h2>
<p>This library will perform shape checks on a best-effort basis. Many things can prevent this library
from being able to check shapes. For example:</p>
<ul class="simple">
<li><p>Unknown shapes. Sometimes the library is not able to determine the shape of an object, and thus
cannot check that object. For example <code class="docutils literal notranslate"><span class="pre">Optional</span></code> arguments with value <code class="docutils literal notranslate"><span class="pre">None</span></code> cannot be
checked, and compiled TensorFlow code can have variables with an unknown shape.</p></li>
<li><p>Use of variable-rank dimensions (see below). In general we cannot infer the size of variable-rank
dimensions if there are multiple variable-rank specifications within the same shape specification
(e.g. <code class="docutils literal notranslate"><span class="pre">cov:</span> <span class="pre">[m...,</span> <span class="pre">n...]</span></code>). This library will try to learn the size of these variable-rank
dimensions from neighbouring shape specifications, but this is not always possible. Use of
<code class="docutils literal notranslate"><span class="pre">broadcast</span></code> with variable-rank dimensions makes it even harder to infer these values.</p></li>
</ul>
</section>
<section id="check-specification">
<h2>Check specification<a class="headerlink" href="#check-specification" title="Permalink to this heading">#</a></h2>
<p>The shapes to check are specified by the arguments to <a class="reference internal" href="#gpflow.experimental.check_shapes.check_shapes" title="gpflow.experimental.check_shapes.check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_shapes()</span></code></a>. Each argument is a
string of the format:</p>
<div class="highlight-bnf notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nc">argument specifier</span><span class="p">&gt;</span> &quot;:&quot; <span class="p">&lt;</span><span class="nc">shape specifier</span><span class="p">&gt;</span> [&quot;if&quot; <span class="p">&lt;</span><span class="nc">condition</span><span class="p">&gt;</span>] [&quot;#&quot; <span class="p">&lt;</span><span class="nc">note</span><span class="p">&gt;</span>]
</pre></div>
</div>
<section id="argument-specification">
<h3>Argument specification<a class="headerlink" href="#argument-specification" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;argument</span> <span class="pre">specifier&gt;</span></code> must start with either the name of an argument to the decorated
function, or the special name <code class="docutils literal notranslate"><span class="pre">return</span></code>. The value <code class="docutils literal notranslate"><span class="pre">return</span></code> refers to the value returned by the
function.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;argument</span> <span class="pre">specifier&gt;</span></code> can then be modified to refer to elements of the object in several
ways:</p>
<ul>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">.&lt;name&gt;</span></code> to refer to an attribute of an object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Statistics</span><span class="p">:</span>
    <span class="n">mean</span><span class="p">:</span> <span class="n">AnyNDArray</span>
    <span class="n">std</span><span class="p">:</span> <span class="n">AnyNDArray</span>

<span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;data: [n_rows, n_columns]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return.mean: [n_columns]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return.std: [n_columns]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">compute_statistics</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Statistics</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">Statistics</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">[&lt;index&gt;]</span></code> to refer to a specific element of a sequence. This is particularly useful if
your function returns a tuple of values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;data: [n_rows, n_columns]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return[0]: [n_columns]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return[1]: [n_columns]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">compute_mean_and_std</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">AnyNDArray</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">[all]</span></code> to select all elements of a collection:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;data[all]: [., n_columns]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [., n_columns]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">concat_rows</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyNDArray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">concat_rows</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">.keys()</span></code> to select all keys of a mapping:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;data.keys(): [.]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: []&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">sum_key_lengths</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>

<span class="n">sum_key_lengths</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,):</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">.values()</span></code> to select all values of a mapping:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;data.values(): [., n_columns]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [., n_columns]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">concat_rows</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AnyNDArray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">concat_rows</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We do not support looking up a specific key or value in a  <code class="docutils literal notranslate"><span class="pre">dict</span></code>.</p>
</div>
<p>If the argument, or any of the looked-up values, are <code class="docutils literal notranslate"><span class="pre">None</span></code> the check is skipped. This is useful
for optional values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;x1: [n_rows_1, n_inputs]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;x2: [n_rows_2, n_inputs]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [n_rows_1, n_rows_2]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">squared_exponential_kernel</span><span class="p">(</span>
    <span class="n">variance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">x2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnyNDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span>
    <span class="n">cov</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">variance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
        <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">x1</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">x2</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">cov</span>

<span class="n">squared_exponential_kernel</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">squared_exponential_kernel</span><span class="p">(</span><span class="mf">3.2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</section>
<section id="shape-specification">
<h3>Shape specification<a class="headerlink" href="#shape-specification" title="Permalink to this heading">#</a></h3>
<p>Shapes are specified by the syntax:</p>
<div class="highlight-bnf notranslate"><div class="highlight"><pre><span></span>&quot;[&quot; <span class="p">&lt;</span><span class="nc">dimension specifier 1</span><span class="p">&gt;</span> &quot;,&quot; <span class="p">&lt;</span><span class="nc">dimension specifer 2</span><span class="p">&gt;</span> &quot;,&quot; ... &quot;,&quot; <span class="p">&lt;</span><span class="nc">dimension specifier n</span><span class="p">&gt;</span> &quot;]&quot;
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;dimension</span> <span class="pre">specifier</span> <span class="pre">i&gt;</span></code> is one of:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code>, to require that dimension to have that exact size:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;v1: [2]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;v2: [2]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">vector_2d_distance</span><span class="p">(</span><span class="n">v1</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">v2</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code>, to bind that dimension to a variable. Dimensions bound to the same variable must
have the same size, though that size can be anything:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;v1: [d]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;v2: [d]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">vector_distance</span><span class="p">(</span><span class="n">v1</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">v2</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code> or <code class="docutils literal notranslate"><span class="pre">.</span></code> to allow exactly one single dimension without constraints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;v: [None]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">vector_length</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;v: [.]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">vector_length</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">*&lt;name&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;...</span></code>, to bind <em>any</em> number of dimensions to a variable. Again,
multiple uses of the same variable name must match the same dimension sizes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;x: [*batch, n_columns]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [*batch]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">batch_mean</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="n">mean</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mean</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;x: [batch..., n_columns]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">batch_mean</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="n">mean</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mean</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">*</span></code> or <code class="docutils literal notranslate"><span class="pre">...</span></code>, to allow <em>any</em> number of dimensions without constraints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;x: [*]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">rank</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;x: [...]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">rank</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>A scalar shape is specified by <code class="docutils literal notranslate"><span class="pre">[]</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;x: [...]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: []&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="n">mean</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span>
    <span class="k">return</span> <span class="n">mean</span>
</pre></div>
</div>
<p>Any of the above can be prefixed with the keyword <code class="docutils literal notranslate"><span class="pre">broadcast</span></code> to allow any value that broadcasts
to the specification. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;a: [broadcast batch...]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;b: [broadcast batch...]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>
</div>
<p>Specifically, to mark a dimension as <code class="docutils literal notranslate"><span class="pre">broadcast</span></code> means:</p>
<ul class="simple">
<li><p>If the specification is that the dimension should have size <code class="docutils literal notranslate"><span class="pre">n</span></code>, then the actual dimension must
have value <code class="docutils literal notranslate"><span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">n</span></code>.</p></li>
<li><p>If all leading dimension specifications are also marked <code class="docutils literal notranslate"><span class="pre">broadcast</span></code>, then the actual shape is
allowed to be shorter than the specification — the dimension is allowed to be missing.</p></li>
</ul>
</section>
<section id="condition-specification">
<h3>Condition specification<a class="headerlink" href="#condition-specification" title="Permalink to this heading">#</a></h3>
<p>You can use the optional <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">&lt;condition&gt;</span></code> syntax to conditionally evaluate shapes. If an <code class="docutils literal notranslate"><span class="pre">if</span>
<span class="pre">&lt;condition&gt;</span></code> is used, the specification is only appplied if <code class="docutils literal notranslate"><span class="pre">&lt;condition&gt;</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code>.
This is useful if shapes depend on other input parameters. Valid conditions are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;argument</span> <span class="pre">specifier&gt;</span></code>, with the same syntax and rules as above, except that constructions that
evaluates to multiple elements are disallowed. Uses the <code class="docutils literal notranslate"><span class="pre">bool</span></code> built-in to convert the value of
the argument to a <code class="docutils literal notranslate"><span class="pre">bool</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;a: [broadcast batch...] if check_a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;b: [broadcast batch...] if check_b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">check_a</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">check_b</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="n">add</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> <span class="n">check_b</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;argument</span> <span class="pre">specifier&gt;</span> <span class="pre">is</span> <span class="pre">None</span></code>, and <code class="docutils literal notranslate"><span class="pre">&lt;argument</span> <span class="pre">specifier&gt;</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">None</span></code>, with the usual rules
for an <code class="docutils literal notranslate"><span class="pre">&lt;argument</span> <span class="pre">specifier&gt;</span></code>, to test whether an argument is, or is not, <code class="docutils literal notranslate"><span class="pre">None</span></code>. We currently
only allow tests against <code class="docutils literal notranslate"><span class="pre">None</span></code>, not general Python equality tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;a: [n_a]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;b: [n_b]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [n_a, n_a] if b is None&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [n_a, n_b] if b is not None&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnyNDArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,)))</span>
<span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,)))</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;left&gt;</span> <span class="pre">or</span> <span class="pre">&lt;right&gt;</span></code>, evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code> if any of <code class="docutils literal notranslate"><span class="pre">&lt;left&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;right&gt;</span></code> evaluates to
<code class="docutils literal notranslate"><span class="pre">True</span></code> and to <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;a: [broadcast batch...] if check_all or check_a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;b: [broadcast batch...] if check_all or check_b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span>
    <span class="n">check_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">check_a</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">check_b</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="n">add</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> <span class="n">check_b</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;left&gt;</span> <span class="pre">and</span> <span class="pre">&lt;right&gt;</span></code>, evaluates to <code class="docutils literal notranslate"><span class="pre">False</span></code> if any of <code class="docutils literal notranslate"><span class="pre">&lt;left&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;right&gt;</span></code> evaluates to
<code class="docutils literal notranslate"><span class="pre">False</span></code> and to <code class="docutils literal notranslate"><span class="pre">True</span></code> otherwise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;a: [broadcast batch...] if enable_checks and check_a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;b: [broadcast batch...] if enable_checks and check_b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span>
    <span class="n">enable_checks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">check_a</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">check_b</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="n">add</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> <span class="n">check_b</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">&lt;right&gt;</span></code>, evaluates to the opposite value of <code class="docutils literal notranslate"><span class="pre">&lt;right&gt;</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;a: [broadcast batch...] if not disable_checks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;b: [broadcast batch...] if not disable_checks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">disable_checks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="n">add</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">(&lt;exp&gt;)</span></code>, uses parenthesis to change operator precedence, as usual.</p></li>
</ul>
<p>Conditions can be composed to apply different specs, depending on function arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;a: [j] if a_vector&quot;</span><span class="p">,</span>
    <span class="s2">&quot;a: [i, j] if (not a_vector)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;b: [j] if b_vector&quot;</span><span class="p">,</span>
    <span class="s2">&quot;b: [j, k] if (not b_vector)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [1, 1] if a_vector and b_vector&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [1, k] if a_vector and (not b_vector)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [i, 1] if (not a_vector) and b_vector&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [i, k] if (not a_vector) and (not b_vector)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">a_vector</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">b_vector</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">a_vector</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">if</span> <span class="n">b_vector</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">a</span> <span class="o">@</span> <span class="n">b</span>

<span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">a_vector</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">b_vector</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All specifications with either no <code class="docutils literal notranslate"><span class="pre">if</span></code> syntax or a <code class="docutils literal notranslate"><span class="pre">&lt;condition&gt;</span></code> that evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code>
will be applied. It is possible for multiple specifications to apply to the same value.</p>
</div>
</section>
<section id="note-specification">
<h3>Note specification<a class="headerlink" href="#note-specification" title="Permalink to this heading">#</a></h3>
<p>You can add notes to your specifications using a <code class="docutils literal notranslate"><span class="pre">#</span></code> followed by the note. These notes will be
appended to relevant error messages and appear in rewritten docstrings. You can add notes in two
places:</p>
<ul>
<li><p>On a single line by itself, to add a note to the entire function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;features: [batch..., n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;# linear_model currently only supports a single output.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;weights: [n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">linear_model</span><span class="p">(</span><span class="n">features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="n">prediction</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;...i,i -&gt; ...&quot;</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prediction</span>
</pre></div>
</div>
</li>
<li><p>After the specification of a single argument, to add a note to that argument only:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;features: [batch..., n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;weights: [n_features] # linear_model currently only supports a single output.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">linear_model</span><span class="p">(</span><span class="n">features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="n">prediction</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;...i,i -&gt; ...&quot;</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prediction</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="shape-reuse">
<h2>Shape reuse<a class="headerlink" href="#shape-reuse" title="Permalink to this heading">#</a></h2>
<p>Just like with other code it is useful to be able to specify a shape in one place and reuse the
specification. In particular this ensures that your code keep having internally consistent shapes,
even if it is refactored.</p>
<section id="class-inheritance">
<h3>Class inheritance<a class="headerlink" href="#class-inheritance" title="Permalink to this heading">#</a></h3>
<p>If you have a class hiererchy, you probably want to ensure that derived classes handle tensors with
the same shapes as the base classes. You can use the <a class="reference internal" href="#gpflow.experimental.check_shapes.inherit_check_shapes" title="gpflow.experimental.check_shapes.inherit_check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">inherit_check_shapes()</span></code></a> decorator to
inherit shapes from overridden methods:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="nd">@check_shapes</span><span class="p">(</span>
        <span class="s2">&quot;features: [batch..., n_features]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">LinearModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="nd">@check_shapes</span><span class="p">(</span>
        <span class="s2">&quot;weights: [n_features]&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="o">=</span> <span class="n">weights</span>

    <span class="nd">@inherit_check_shapes</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
        <span class="n">prediction</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;...i,i -&gt; ...&quot;</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prediction</span>
</pre></div>
</div>
</section>
<section id="functional-programming">
<h3>Functional programming<a class="headerlink" href="#functional-programming" title="Permalink to this heading">#</a></h3>
<p>If you prefer functional- over object oriented programming, you may have functions that you require
to handle the same shapes. To do this, remember that in Python a decorator is just a function, and
functions are objects that can be stored:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">check_metric_shapes</span> <span class="o">=</span> <span class="n">check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;actual: [n_rows, n_labels]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;predicted: [n_rows, n_labels]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: []&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="nd">@check_metric_shapes</span>
<span class="k">def</span> <span class="nf">rmse</span><span class="p">(</span><span class="n">actual</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">predicted</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">predicted</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))))</span>

<span class="nd">@check_metric_shapes</span>
<span class="k">def</span> <span class="nf">mape</span><span class="p">(</span><span class="n">actual</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">predicted</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">predicted</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">/</span> <span class="n">actual</span><span class="p">)))</span>
</pre></div>
</div>
</section>
<section id="other-reuse-of-shapes">
<h3>Other reuse of shapes<a class="headerlink" href="#other-reuse-of-shapes" title="Permalink to this heading">#</a></h3>
<p>You can use <a class="reference internal" href="#gpflow.experimental.check_shapes.get_check_shapes" title="gpflow.experimental.check_shapes.get_check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_check_shapes()</span></code></a> to get, and reuse, the shape definitions from a previously
declared function. This is particularly useful to ensure fakes in tests use the same shapes as the
production implementation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="nd">@check_shapes</span><span class="p">(</span>
        <span class="s2">&quot;features: [batch..., n_features]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;test_features: [n_rows, n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;test_labels: [n_rows]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">evaluate_model</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">test_features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_features</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">prediction</span> <span class="o">-</span> <span class="n">test_labels</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))))</span>

<span class="k">def</span> <span class="nf">test_evaluate_model</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">fake_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">fake_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">10</span><span class="p">,))</span>
    <span class="n">fake_predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">10</span><span class="p">,))</span>

    <span class="nd">@get_check_shapes</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">predict</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fake_predict</span><span class="p">(</span><span class="n">features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">features</span> <span class="ow">is</span> <span class="n">fake_features</span>
        <span class="k">return</span> <span class="n">fake_predictions</span>

    <span class="n">fake_model</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">Model</span><span class="p">,</span> <span class="n">predict</span><span class="o">=</span><span class="n">fake_predict</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">==</span> <span class="n">evaluate_model</span><span class="p">(</span><span class="n">fake_model</span><span class="p">,</span> <span class="n">fake_features</span><span class="p">,</span> <span class="n">fake_labels</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="checking-intermediate-results">
<h2>Checking intermediate results<a class="headerlink" href="#checking-intermediate-results" title="Permalink to this heading">#</a></h2>
<p>You can use the function <a class="reference internal" href="#gpflow.experimental.check_shapes.check_shape" title="gpflow.experimental.check_shapes.check_shape"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_shape()</span></code></a> to check the shape of an intermediate result. This
function will use the same namespace as the immediately surrounding <a class="reference internal" href="#gpflow.experimental.check_shapes.check_shapes" title="gpflow.experimental.check_shapes.check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_shapes()</span></code></a> decorator,
and should only be called within functions that has such a decorator. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;weights: [n_features, n_labels]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;test_features: [n_rows, n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;test_labels: [n_rows, n_labels]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: []&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="n">weights</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">test_features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">check_shape</span><span class="p">(</span><span class="n">test_features</span> <span class="o">@</span> <span class="n">weights</span><span class="p">,</span> <span class="s2">&quot;[n_rows, n_labels]&quot;</span><span class="p">)</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">check_shape</span><span class="p">(</span><span class="n">prediction</span> <span class="o">-</span> <span class="n">test_labels</span><span class="p">,</span> <span class="s2">&quot;[n_rows, n_labels]&quot;</span><span class="p">)</span>
    <span class="n">square_error</span> <span class="o">=</span> <span class="n">check_shape</span><span class="p">(</span><span class="n">error</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;[n_rows, n_labels]&quot;</span><span class="p">)</span>
    <span class="n">mean_square_error</span> <span class="o">=</span> <span class="n">check_shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">square_error</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;[n_rows]&quot;</span><span class="p">)</span>
    <span class="n">root_mean_square_error</span> <span class="o">=</span> <span class="n">check_shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_square_error</span><span class="p">),</span> <span class="s2">&quot;[n_rows]&quot;</span><span class="p">)</span>
    <span class="n">loss</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">root_mean_square_error</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span>
</pre></div>
</div>
</section>
<section id="checking-shapes-without-a-decorator">
<h2>Checking shapes without a decorator<a class="headerlink" href="#checking-shapes-without-a-decorator" title="Permalink to this heading">#</a></h2>
<p>While the <a class="reference internal" href="#gpflow.experimental.check_shapes.check_shapes" title="gpflow.experimental.check_shapes.check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_shapes()</span></code></a> decorator is the recommend way to use this library, it is possible to
use it without the decorator. In fact the decorator is just a wrapper around the class
<a class="reference internal" href="#gpflow.experimental.check_shapes.ShapeChecker" title="gpflow.experimental.check_shapes.ShapeChecker"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShapeChecker</span></code></a>, which can be used to check shapes directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">linear_model</span><span class="p">(</span><span class="n">features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="n">checker</span> <span class="o">=</span> <span class="n">ShapeChecker</span><span class="p">()</span>
    <span class="n">checker</span><span class="o">.</span><span class="n">check_shape</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="s2">&quot;[batch..., n_features]&quot;</span><span class="p">)</span>
    <span class="n">checker</span><span class="o">.</span><span class="n">check_shape</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="s2">&quot;[n_features]&quot;</span><span class="p">)</span>
    <span class="n">prediction</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">checker</span><span class="o">.</span><span class="n">check_shape</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;...i,i -&gt; ...&quot;</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">weights</span><span class="p">),</span> <span class="s2">&quot;[batch...]&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">prediction</span>
</pre></div>
</div>
<p>You can use the function <a class="reference internal" href="#gpflow.experimental.check_shapes.get_shape_checker" title="gpflow.experimental.check_shapes.get_shape_checker"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_shape_checker()</span></code></a> to get the <a class="reference internal" href="#gpflow.experimental.check_shapes.ShapeChecker" title="gpflow.experimental.check_shapes.ShapeChecker"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShapeChecker</span></code></a> used by any
immediately surrounding <a class="reference internal" href="#gpflow.experimental.check_shapes.check_shapes" title="gpflow.experimental.check_shapes.check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_shapes()</span></code></a> decorator.</p>
</section>
<section id="documenting-shapes">
<h2>Documenting shapes<a class="headerlink" href="#documenting-shapes" title="Permalink to this heading">#</a></h2>
<p>The <a class="reference internal" href="#gpflow.experimental.check_shapes.check_shapes" title="gpflow.experimental.check_shapes.check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_shapes()</span></code></a> decorator rewrites the docstring (<code class="docutils literal notranslate"><span class="pre">.__doc__</span></code>) of the decorated function
to add information about shapes, in a format compatible with
<a class="reference external" href="https://www.sphinx-doc.org/en/master/">Sphinx</a>.</p>
<p>Only functions that already have a docstring will be updated. Functions that have no docstring at
all will not have one added, this is so that we do not override a docstring that would have been
inherited from a super class.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;features: [batch..., n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;weights: [n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">linear_model</span><span class="p">(</span><span class="n">features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes a prediction from a linear model.</span>

<span class="sd">    :param features: Data to make predictions from.</span>
<span class="sd">    :param weights: Model weights.</span>
<span class="sd">    :returns: Model predictions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prediction</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;...i,i -&gt; ...&quot;</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prediction</span>
</pre></div>
</div>
<p>will have <code class="docutils literal notranslate"><span class="pre">.__doc__</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Computes a prediction from a linear model.</span>

<span class="sd">:param features:</span>
<span class="sd">    * **features** has shape [*batch*..., *n_features*].</span>

<span class="sd">    Data to make predictions from.</span>
<span class="sd">:param weights:</span>
<span class="sd">    * **weights** has shape [*n_features*].</span>

<span class="sd">    Model weights.</span>
<span class="sd">:returns:</span>
<span class="sd">    * **return** has shape [*batch*...].</span>

<span class="sd">    Model predictions.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>if you do not wish to have your docstrings rewritten, you can disable it with
<a class="reference internal" href="#gpflow.experimental.check_shapes.set_rewrite_docstrings" title="gpflow.experimental.check_shapes.set_rewrite_docstrings"><code class="xref py py-func docutils literal notranslate"><span class="pre">set_rewrite_docstrings()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">set_rewrite_docstrings</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="supported-types">
<h2>Supported types<a class="headerlink" href="#supported-types" title="Permalink to this heading">#</a></h2>
<p>This library has built-in support for checking the shapes of:</p>
<ul class="simple">
<li><p>Python built-in scalars: <code class="docutils literal notranslate"><span class="pre">bool</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code> and <code class="docutils literal notranslate"><span class="pre">str</span></code>.</p></li>
<li><p>Python built-in sequences: <code class="docutils literal notranslate"><span class="pre">tuple</span></code> and <code class="docutils literal notranslate"><span class="pre">list</span></code>.</p></li>
<li><p>NumPy <code class="docutils literal notranslate"><span class="pre">ndarray</span></code>s.</p></li>
<li><p>TensorFlow <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>s and <code class="docutils literal notranslate"><span class="pre">Variable</span></code>s.</p></li>
<li><p>TensorFlow Probability <code class="docutils literal notranslate"><span class="pre">DeferredTensor</span></code>s, including <code class="docutils literal notranslate"><span class="pre">TransformedVariable</span></code> and
<a class="reference internal" href="../../index.html#gpflow.Parameter" title="gpflow.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">gpflow.Parameter</span></code></a>.</p></li>
</ul>
<section id="shapes-of-custom-types">
<h3>Shapes of custom types<a class="headerlink" href="#shapes-of-custom-types" title="Permalink to this heading">#</a></h3>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">check_shapes</span></code> uses the function <a class="reference internal" href="#gpflow.experimental.check_shapes.get_shape" title="gpflow.experimental.check_shapes.get_shape"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_shape()</span></code></a> to extract the shape of an object.
You can use <a class="reference internal" href="#gpflow.experimental.check_shapes.register_get_shape" title="gpflow.experimental.check_shapes.register_get_shape"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_get_shape()</span></code></a> to extend <a class="reference internal" href="#gpflow.experimental.check_shapes.get_shape" title="gpflow.experimental.check_shapes.get_shape"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_shape()</span></code></a> to extract shapes for you own
custom types:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LinearModel</span><span class="p">:</span>
    <span class="nd">@check_shapes</span><span class="p">(</span>
        <span class="s2">&quot;weights: [n_features]&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="o">=</span> <span class="n">weights</span>

    <span class="nd">@check_shapes</span><span class="p">(</span>
        <span class="s2">&quot;self: [n_features]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;features: [batch..., n_features]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
        <span class="n">prediction</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;...i,i -&gt; ...&quot;</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prediction</span>

<span class="nd">@register_get_shape</span><span class="p">(</span><span class="n">LinearModel</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_linear_model_shape</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ErrorContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Shape</span><span class="p">:</span>
    <span class="n">shape</span><span class="p">:</span> <span class="n">Shape</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_weights</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">return</span> <span class="n">shape</span>

<span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;model: [n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;test_features: [n_rows, n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;test_labels: [n_rows]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: []&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">,</span> <span class="n">test_features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_features</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">prediction</span> <span class="o">-</span> <span class="n">test_labels</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))))</span>
</pre></div>
</div>
</section>
</section>
<section id="modules">
<h2>Modules<a class="headerlink" href="#modules" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="accessors/index.html">gpflow.experimental.check_shapes.accessors</a></li>
<li class="toctree-l1"><a class="reference internal" href="argument_ref/index.html">gpflow.experimental.check_shapes.argument_ref</a></li>
<li class="toctree-l1"><a class="reference internal" href="bool_specs/index.html">gpflow.experimental.check_shapes.bool_specs</a></li>
<li class="toctree-l1"><a class="reference internal" href="checker_context/index.html">gpflow.experimental.check_shapes.checker_context</a></li>
<li class="toctree-l1"><a class="reference internal" href="decorator/index.html">gpflow.experimental.check_shapes.decorator</a></li>
<li class="toctree-l1"><a class="reference internal" href="error_contexts/index.html">gpflow.experimental.check_shapes.error_contexts</a></li>
<li class="toctree-l1"><a class="reference internal" href="exceptions/index.html">gpflow.experimental.check_shapes.exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="parser/index.html">gpflow.experimental.check_shapes.parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="shapes/index.html">gpflow.experimental.check_shapes.shapes</a></li>
<li class="toctree-l1"><a class="reference internal" href="specs/index.html">gpflow.experimental.check_shapes.specs</a></li>
</ul>
</div>
</section>
<section id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Permalink to this heading">#</a></h2>
<section id="gpflow-experimental-check-shapes-docstringformat">
<h3>gpflow.experimental.check_shapes.DocstringFormat<a class="headerlink" href="#gpflow-experimental-check-shapes-docstringformat" title="Permalink to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.DocstringFormat">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">DocstringFormat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/config.html#DocstringFormat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.DocstringFormat" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></p>
<p>Enumeration of supported formats of docstrings.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.DocstringFormat.NONE">
<span class="sig-name descname"><span class="pre">NONE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'none'</span></em><a class="headerlink" href="#gpflow.experimental.check_shapes.DocstringFormat.NONE" title="Permalink to this definition">#</a></dt>
<dd><p>Do not rewrite docstrings.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.DocstringFormat.SPHINX">
<span class="sig-name descname"><span class="pre">SPHINX</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'sphinx'</span></em><a class="headerlink" href="#gpflow.experimental.check_shapes.DocstringFormat.SPHINX" title="Permalink to this definition">#</a></dt>
<dd><p>Rewrite docstrings in the <a class="reference external" href="https://www.sphinx-doc.org/en/master/">Sphinx</a> format.</p>
</dd></dl>

</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-errorcontext">
<h3>gpflow.experimental.check_shapes.ErrorContext<a class="headerlink" href="#gpflow-experimental-check-shapes-errorcontext" title="Permalink to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.ErrorContext">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">ErrorContext</span></span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/error_contexts.html#ErrorContext"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.ErrorContext" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ABC</span></code></p>
<p>A context in which an error can occur.</p>
<p>Contexts should be immutable, and implement <code class="xref py py-func docutils literal notranslate"><span class="pre">__eq__()</span></code> - so that they can be composed using
<code class="xref py py-class docutils literal notranslate"><span class="pre">StackContext</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">ParallelContext</span></code>.</p>
<p>The contexts are often created even if an error doesn’t actually occur, so they should be cheap
to create - prefer to do any slow computation in <a class="reference internal" href="#gpflow.experimental.check_shapes.ErrorContext.print" title="gpflow.experimental.check_shapes.ErrorContext.print"><code class="xref py py-func docutils literal notranslate"><span class="pre">print()</span></code></a>, rather than in <code class="xref py py-func docutils literal notranslate"><span class="pre">__init__()</span></code>.</p>
<p>Maybe think of an <a class="reference internal" href="#gpflow.experimental.check_shapes.ErrorContext" title="gpflow.experimental.check_shapes.ErrorContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ErrorContext</span></code></a> as a factory of error messages.</p>
<dl class="py method">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.ErrorContext.print">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">print</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builder</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/error_contexts.html#ErrorContext.print"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.ErrorContext.print" title="Permalink to this definition">#</a></dt>
<dd><p>Print this context to the given <cite>MessageBuilder</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>builder</strong> (<a class="reference internal" href="error_contexts/index.html#gpflow.experimental.check_shapes.error_contexts.MessageBuilder" title="gpflow.experimental.check_shapes.error_contexts.MessageBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">MessageBuilder</span></code></a>) – </p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-shapechecker">
<h3>gpflow.experimental.check_shapes.ShapeChecker<a class="headerlink" href="#gpflow-experimental-check-shapes-shapechecker" title="Permalink to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.ShapeChecker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">ShapeChecker</span></span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/checker.html#ShapeChecker"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.ShapeChecker" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Mechanism for checking the shapes of tensors.</p>
<p>This remembers observed shapes and specifications, so that tensors can be checked for
compatibility across multiple calls, and so that we can provide good error messages.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">linear_model</span><span class="p">(</span><span class="n">features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="n">checker</span> <span class="o">=</span> <span class="n">ShapeChecker</span><span class="p">()</span>
    <span class="n">checker</span><span class="o">.</span><span class="n">check_shape</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="s2">&quot;[batch..., n_features]&quot;</span><span class="p">)</span>
    <span class="n">checker</span><span class="o">.</span><span class="n">check_shape</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="s2">&quot;[n_features]&quot;</span><span class="p">)</span>
    <span class="n">prediction</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">checker</span><span class="o">.</span><span class="n">check_shape</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;...i,i -&gt; ...&quot;</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">weights</span><span class="p">),</span> <span class="s2">&quot;[batch...]&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">prediction</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.ShapeChecker.add_context">
<span class="sig-name descname"><span class="pre">add_context</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/checker.html#ShapeChecker.add_context"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.ShapeChecker.add_context" title="Permalink to this definition">#</a></dt>
<dd><p>Add arbirtary context to the shape checker.</p>
<p>This context will be included in any error messages.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>context</strong> (<a class="reference internal" href="#gpflow.experimental.check_shapes.ErrorContext" title="gpflow.experimental.check_shapes.error_contexts.ErrorContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ErrorContext</span></code></a>) – Context to add to this shape checker.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.ShapeChecker.check_shape">
<span class="sig-name descname"><span class="pre">check_shape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shaped</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tensor_spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/checker.html#ShapeChecker.check_shape"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.ShapeChecker.check_shape" title="Permalink to this definition">#</a></dt>
<dd><p>Raise an error if a tensor has the wrong shape.</p>
<p>This remembers observed shapes and specifications, so that tensors can be checked for
compatibility across multiple calls, and so that we can provide good error messages.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shaped</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">TypeVar</span></code>(<code class="docutils literal notranslate"><span class="pre">S</span></code>)) – The object whose shape to check.</p></li>
<li><p><strong>tensor_spec</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<a class="reference internal" href="specs/index.html#gpflow.experimental.check_shapes.specs.ParsedTensorSpec" title="gpflow.experimental.check_shapes.specs.ParsedTensorSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParsedTensorSpec</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>], <code class="xref py py-data docutils literal notranslate"><span class="pre">...</span></code>], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]) – Specification to check the tensor against.
Usually this is a <code class="docutils literal notranslate"><span class="pre">str</span></code> in the format described in <a class="reference internal" href="#shape-specification">Shape specification</a>.
Alternatively this can be a pre-parsed <code class="xref py py-class docutils literal notranslate"><span class="pre">ParsedTensorSpec</span></code>, or an actual
<code class="xref py py-class docutils literal notranslate"><span class="pre">Shape</span></code>.</p></li>
<li><p><strong>context</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<a class="reference internal" href="#gpflow.experimental.check_shapes.ErrorContext" title="gpflow.experimental.check_shapes.error_contexts.ErrorContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ErrorContext</span></code></a>]) – Information about where <code class="docutils literal notranslate"><span class="pre">shaped</span></code> is coming from, for improved error
messages.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeVar</span></code>(<code class="docutils literal notranslate"><span class="pre">S</span></code>)</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">shaped</span></code>, for convenience.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.ShapeChecker.check_shapes">
<span class="sig-name descname"><span class="pre">check_shapes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">checks</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/checker.html#ShapeChecker.check_shapes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.ShapeChecker.check_shapes" title="Permalink to this definition">#</a></dt>
<dd><p>Raise an error if any tensor has the wrong shape.</p>
<p>This remembers observed shapes and specifications, so that tensors can be checked for
compatibility across multiple calls, and so that we can provide good error messages.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>checks</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<a class="reference internal" href="specs/index.html#gpflow.experimental.check_shapes.specs.ParsedTensorSpec" title="gpflow.experimental.check_shapes.specs.ParsedTensorSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParsedTensorSpec</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>], <code class="xref py py-data docutils literal notranslate"><span class="pre">...</span></code>], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]], <code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<a class="reference internal" href="specs/index.html#gpflow.experimental.check_shapes.specs.ParsedTensorSpec" title="gpflow.experimental.check_shapes.specs.ParsedTensorSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParsedTensorSpec</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>], <code class="xref py py-data docutils literal notranslate"><span class="pre">...</span></code>], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>], <a class="reference internal" href="#gpflow.experimental.check_shapes.ErrorContext" title="gpflow.experimental.check_shapes.error_contexts.ErrorContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ErrorContext</span></code></a>]]]) – Checks to perform. The elements can either be <code class="docutils literal notranslate"><span class="pre">(shaped,</span> <span class="pre">tensor_spec)</span></code> or
<code class="docutils literal notranslate"><span class="pre">(shaped,</span> <span class="pre">tensor_spec,</span> <span class="pre">context)</span></code> tuples. Where: <code class="docutils literal notranslate"><span class="pre">shaped</span></code> is the tensor whose shape
to check; <code class="docutils literal notranslate"><span class="pre">tensor_spec</span></code> is the specification to check it against (see <a class="reference internal" href="#shape-specification">Shape
specification</a>); and <code class="docutils literal notranslate"><span class="pre">context</span></code> contains (optional) information about where <code class="docutils literal notranslate"><span class="pre">shaped</span></code>
came from - for better error messages.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-shapecheckingstate">
<h3>gpflow.experimental.check_shapes.ShapeCheckingState<a class="headerlink" href="#gpflow-experimental-check-shapes-shapecheckingstate" title="Permalink to this heading">#</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.ShapeCheckingState">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">ShapeCheckingState</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/config.html#ShapeCheckingState"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.ShapeCheckingState" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></p>
<p>Different states of whether to actually check shapes.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.ShapeCheckingState.DISABLED">
<span class="sig-name descname"><span class="pre">DISABLED</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'disabled'</span></em><a class="headerlink" href="#gpflow.experimental.check_shapes.ShapeCheckingState.DISABLED" title="Permalink to this definition">#</a></dt>
<dd><p>Never check shapes.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.ShapeCheckingState.EAGER_MODE_ONLY">
<span class="sig-name descname"><span class="pre">EAGER_MODE_ONLY</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'eager_mode_only'</span></em><a class="headerlink" href="#gpflow.experimental.check_shapes.ShapeCheckingState.EAGER_MODE_ONLY" title="Permalink to this definition">#</a></dt>
<dd><p>Only check shapes if <cite>tf.inside_function()</cite> is <cite>False</cite>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.ShapeCheckingState.ENABLED">
<span class="sig-name descname"><span class="pre">ENABLED</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'enabled'</span></em><a class="headerlink" href="#gpflow.experimental.check_shapes.ShapeCheckingState.ENABLED" title="Permalink to this definition">#</a></dt>
<dd><p>Always check shapes.</p>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this heading">#</a></h2>
<section id="gpflow-experimental-check-shapes-check-shape">
<h3>gpflow.experimental.check_shapes.check_shape<a class="headerlink" href="#gpflow-experimental-check-shapes-check-shape" title="Permalink to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.check_shape">
<span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">check_shape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shaped</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tensor_spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/checker_context.html#check_shape"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.check_shape" title="Permalink to this definition">#</a></dt>
<dd><p>Raise an error if a tensor has the wrong shape.</p>
<p>This uses the <a class="reference internal" href="#gpflow.experimental.check_shapes.ShapeChecker" title="gpflow.experimental.check_shapes.ShapeChecker"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShapeChecker</span></code></a> from the wrapping <a class="reference internal" href="#gpflow.experimental.check_shapes.check_shapes" title="gpflow.experimental.check_shapes.check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_shapes()</span></code></a> decorator. Behaviour
is undefined if you call this from a function that is not directly wrapped in
<a class="reference internal" href="#gpflow.experimental.check_shapes.check_shapes" title="gpflow.experimental.check_shapes.check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_shapes()</span></code></a> or <a class="reference internal" href="#gpflow.experimental.check_shapes.inherit_check_shapes" title="gpflow.experimental.check_shapes.inherit_check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">inherit_check_shapes()</span></code></a>.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;weights: [n_features, n_labels]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;test_features: [n_rows, n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;test_labels: [n_rows, n_labels]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: []&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="n">weights</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">test_features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">check_shape</span><span class="p">(</span><span class="n">test_features</span> <span class="o">@</span> <span class="n">weights</span><span class="p">,</span> <span class="s2">&quot;[n_rows, n_labels]&quot;</span><span class="p">)</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">check_shape</span><span class="p">(</span><span class="n">prediction</span> <span class="o">-</span> <span class="n">test_labels</span><span class="p">,</span> <span class="s2">&quot;[n_rows, n_labels]&quot;</span><span class="p">)</span>
    <span class="n">square_error</span> <span class="o">=</span> <span class="n">check_shape</span><span class="p">(</span><span class="n">error</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;[n_rows, n_labels]&quot;</span><span class="p">)</span>
    <span class="n">mean_square_error</span> <span class="o">=</span> <span class="n">check_shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">square_error</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;[n_rows]&quot;</span><span class="p">)</span>
    <span class="n">root_mean_square_error</span> <span class="o">=</span> <span class="n">check_shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_square_error</span><span class="p">),</span> <span class="s2">&quot;[n_rows]&quot;</span><span class="p">)</span>
    <span class="n">loss</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">root_mean_square_error</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shaped</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">TypeVar</span></code>(<code class="docutils literal notranslate"><span class="pre">S</span></code>)) – The object whose shape to check.</p></li>
<li><p><strong>tensor_spec</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<a class="reference internal" href="specs/index.html#gpflow.experimental.check_shapes.specs.ParsedTensorSpec" title="gpflow.experimental.check_shapes.specs.ParsedTensorSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParsedTensorSpec</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>], <code class="xref py py-data docutils literal notranslate"><span class="pre">...</span></code>], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]) – Specification to check the tensor against. See: <a class="reference internal" href="#shape-specification">Shape specification</a>.</p></li>
<li><p><strong>context</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<a class="reference internal" href="#gpflow.experimental.check_shapes.ErrorContext" title="gpflow.experimental.check_shapes.error_contexts.ErrorContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ErrorContext</span></code></a>]) – Information about where <code class="docutils literal notranslate"><span class="pre">shaped</span></code> is coming from, for improved error
messages.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeVar</span></code>(<code class="docutils literal notranslate"><span class="pre">S</span></code>)</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">shaped</span></code>, for convenience.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-check-shapes">
<h3>gpflow.experimental.check_shapes.check_shapes<a class="headerlink" href="#gpflow-experimental-check-shapes-check-shapes" title="Permalink to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.check_shapes">
<span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">check_shapes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tf_decorator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/decorator.html#check_shapes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.check_shapes" title="Permalink to this definition">#</a></dt>
<dd><p>Decorator that checks the shapes of tensor arguments.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="kn">from</span> <span class="nn">gpflow.experimental.check_shapes</span> <span class="kn">import</span> <span class="n">check_shapes</span>

<span class="nd">@tf</span><span class="o">.</span><span class="n">function</span>
<span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;features: [batch..., n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;weights: [n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">linear_model</span><span class="p">(</span><span class="n">features</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;...i,i -&gt; ...&quot;</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>specs</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Specification of arguments to check. See: <a class="reference internal" href="#check-specification">Check specification</a>.</p></li>
<li><p><strong>tf_decorator</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – Whether to wrap the shape check with
<code class="docutils literal notranslate"><span class="pre">tf.compat.v1.flags.tf_decorator.make_decorator</span></code>.
Setting this <cite>True</cite> seems to solve some problems, particularly related to Keras models,
but create some other problems, particularly related to branching on tensors.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-class docutils literal notranslate"><span class="pre">TypeVar</span></code>(<code class="docutils literal notranslate"><span class="pre">C</span></code>, bound= <code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">...</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>])], <code class="xref py py-class docutils literal notranslate"><span class="pre">TypeVar</span></code>(<code class="docutils literal notranslate"><span class="pre">C</span></code>, bound= <code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">...</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>])]</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-disable-check-shapes">
<h3>gpflow.experimental.check_shapes.disable_check_shapes<a class="headerlink" href="#gpflow-experimental-check-shapes-disable-check-shapes" title="Permalink to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.disable_check_shapes">
<span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">disable_check_shapes</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/config.html#disable_check_shapes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.disable_check_shapes" title="Permalink to this definition">#</a></dt>
<dd><p>Context manager that temporarily disables shape checking.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">disable_check_shapes</span><span class="p">():</span>
    <span class="n">performance_sensitive_function</span><span class="p">()</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterator</span></code>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-get-check-shapes">
<h3>gpflow.experimental.check_shapes.get_check_shapes<a class="headerlink" href="#gpflow-experimental-check-shapes-get-check-shapes" title="Permalink to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.get_check_shapes">
<span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">get_check_shapes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/accessors.html#get_check_shapes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.get_check_shapes" title="Permalink to this definition">#</a></dt>
<dd><p>Get the <code class="docutils literal notranslate"><span class="pre">check_shapes</span></code> that was applied to <code class="docutils literal notranslate"><span class="pre">func</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If no <code class="docutils literal notranslate"><span class="pre">check_shapes</span></code> was applied to <code class="docutils literal notranslate"><span class="pre">func</span></code>.</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>func</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">...</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]) – </p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-class docutils literal notranslate"><span class="pre">TypeVar</span></code>(<code class="docutils literal notranslate"><span class="pre">C</span></code>, bound= <code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">...</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>])], <code class="xref py py-class docutils literal notranslate"><span class="pre">TypeVar</span></code>(<code class="docutils literal notranslate"><span class="pre">C</span></code>, bound= <code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">...</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>])]</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-get-enable-check-shapes">
<h3>gpflow.experimental.check_shapes.get_enable_check_shapes<a class="headerlink" href="#gpflow-experimental-check-shapes-get-enable-check-shapes" title="Permalink to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.get_enable_check_shapes">
<span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">get_enable_check_shapes</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/config.html#get_enable_check_shapes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.get_enable_check_shapes" title="Permalink to this definition">#</a></dt>
<dd><p>Get whether to enable <code class="xref py py-mod docutils literal notranslate"><span class="pre">check_shapes</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#gpflow.experimental.check_shapes.ShapeCheckingState" title="gpflow.experimental.check_shapes.config.ShapeCheckingState"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShapeCheckingState</span></code></a></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-get-enable-function-call-precompute">
<h3>gpflow.experimental.check_shapes.get_enable_function_call_precompute<a class="headerlink" href="#gpflow-experimental-check-shapes-get-enable-function-call-precompute" title="Permalink to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.get_enable_function_call_precompute">
<span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">get_enable_function_call_precompute</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/config.html#get_enable_function_call_precompute"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.get_enable_function_call_precompute" title="Permalink to this definition">#</a></dt>
<dd><p>Get whether to precompute function call path and line numbers for debugging.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-get-rewrite-docstrings">
<h3>gpflow.experimental.check_shapes.get_rewrite_docstrings<a class="headerlink" href="#gpflow-experimental-check-shapes-get-rewrite-docstrings" title="Permalink to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.get_rewrite_docstrings">
<span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">get_rewrite_docstrings</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/config.html#get_rewrite_docstrings"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.get_rewrite_docstrings" title="Permalink to this definition">#</a></dt>
<dd><p>Get how <code class="xref py py-mod docutils literal notranslate"><span class="pre">check_shapes</span></code> should rewrite docstrings.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#gpflow.experimental.check_shapes.DocstringFormat" title="gpflow.experimental.check_shapes.config.DocstringFormat"><code class="xref py py-class docutils literal notranslate"><span class="pre">DocstringFormat</span></code></a></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-get-shape">
<h3>gpflow.experimental.check_shapes.get_shape<a class="headerlink" href="#gpflow-experimental-check-shapes-get-shape" title="Permalink to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.get_shape">
<span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">get_shape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shaped</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/shapes.html#get_shape"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.get_shape" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the shape of the given object.</p>
<p>See also <a class="reference internal" href="#gpflow.experimental.check_shapes.register_get_shape" title="gpflow.experimental.check_shapes.register_get_shape"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_get_shape()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shaped</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>) – The objects whose shape to extract.</p></li>
<li><p><strong>context</strong> (<a class="reference internal" href="#gpflow.experimental.check_shapes.ErrorContext" title="gpflow.experimental.check_shapes.error_contexts.ErrorContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ErrorContext</span></code></a>) – Context we are getting the shape in, for improved error messages.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>], <code class="xref py py-data docutils literal notranslate"><span class="pre">...</span></code>]]</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The shape of <code class="docutils literal notranslate"><span class="pre">shaped</span></code>, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if the shape exists, but is unknown.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="exceptions/index.html#gpflow.experimental.check_shapes.exceptions.NoShapeError" title="gpflow.experimental.check_shapes.exceptions.NoShapeError"><strong>NoShapeError</strong></a> – If objects of this type does not have shapes.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-get-shape-checker">
<h3>gpflow.experimental.check_shapes.get_shape_checker<a class="headerlink" href="#gpflow-experimental-check-shapes-get-shape-checker" title="Permalink to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.get_shape_checker">
<span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">get_shape_checker</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/checker_context.html#get_shape_checker"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.get_shape_checker" title="Permalink to this definition">#</a></dt>
<dd><p>Get the <a class="reference internal" href="#gpflow.experimental.check_shapes.ShapeChecker" title="gpflow.experimental.check_shapes.ShapeChecker"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShapeChecker</span></code></a> from the wrapping <a class="reference internal" href="#gpflow.experimental.check_shapes.check_shapes" title="gpflow.experimental.check_shapes.check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_shapes()</span></code></a> decorator.</p>
<p>Behaviour is undefined if you call this from a function that is not directly wrapped in
<a class="reference internal" href="#gpflow.experimental.check_shapes.check_shapes" title="gpflow.experimental.check_shapes.check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_shapes()</span></code></a> or <a class="reference internal" href="#gpflow.experimental.check_shapes.inherit_check_shapes" title="gpflow.experimental.check_shapes.inherit_check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">inherit_check_shapes()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#gpflow.experimental.check_shapes.ShapeChecker" title="gpflow.experimental.check_shapes.checker.ShapeChecker"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShapeChecker</span></code></a></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-inherit-check-shapes">
<h3>gpflow.experimental.check_shapes.inherit_check_shapes<a class="headerlink" href="#gpflow-experimental-check-shapes-inherit-check-shapes" title="Permalink to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.inherit_check_shapes">
<span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">inherit_check_shapes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/inheritance.html#inherit_check_shapes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.inherit_check_shapes" title="Permalink to this definition">#</a></dt>
<dd><p>Decorator that inherits the <a class="reference internal" href="#gpflow.experimental.check_shapes.check_shapes" title="gpflow.experimental.check_shapes.check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_shapes()</span></code></a> decoration from any overridden method in a
super-class.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="nd">@check_shapes</span><span class="p">(</span>
        <span class="s2">&quot;features: [batch..., n_features]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">LinearModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="nd">@check_shapes</span><span class="p">(</span>
        <span class="s2">&quot;weights: [n_features]&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="o">=</span> <span class="n">weights</span>

    <span class="nd">@inherit_check_shapes</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
        <span class="n">prediction</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;...i,i -&gt; ...&quot;</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prediction</span>
</pre></div>
</div>
<p>See: <a class="reference internal" href="#class-inheritance">Class inheritance</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>func</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">TypeVar</span></code>(<code class="docutils literal notranslate"><span class="pre">C</span></code>, bound= <code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">...</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>])) – </p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeVar</span></code>(<code class="docutils literal notranslate"><span class="pre">C</span></code>, bound= <code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">...</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>])</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-register-get-shape">
<h3>gpflow.experimental.check_shapes.register_get_shape<a class="headerlink" href="#gpflow-experimental-check-shapes-register-get-shape" title="Permalink to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.register_get_shape">
<span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">register_get_shape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shape_type</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/shapes.html#register_get_shape"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.register_get_shape" title="Permalink to this definition">#</a></dt>
<dd><p>Register a function for extracting the shape from a given type of objects.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LinearModel</span><span class="p">:</span>
    <span class="nd">@check_shapes</span><span class="p">(</span>
        <span class="s2">&quot;weights: [n_features]&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="o">=</span> <span class="n">weights</span>

    <span class="nd">@check_shapes</span><span class="p">(</span>
        <span class="s2">&quot;self: [n_features]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;features: [batch..., n_features]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;return: [batch...]&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyNDArray</span><span class="p">:</span>
        <span class="n">prediction</span><span class="p">:</span> <span class="n">AnyNDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;...i,i -&gt; ...&quot;</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prediction</span>

<span class="nd">@register_get_shape</span><span class="p">(</span><span class="n">LinearModel</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_linear_model_shape</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ErrorContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Shape</span><span class="p">:</span>
    <span class="n">shape</span><span class="p">:</span> <span class="n">Shape</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_weights</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">return</span> <span class="n">shape</span>

<span class="nd">@check_shapes</span><span class="p">(</span>
    <span class="s2">&quot;model: [n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;test_features: [n_rows, n_features]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;test_labels: [n_rows]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return: []&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">,</span> <span class="n">test_features</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">:</span> <span class="n">AnyNDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_features</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">prediction</span> <span class="o">-</span> <span class="n">test_labels</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))))</span>
</pre></div>
</div>
<p>See also <a class="reference internal" href="#gpflow.experimental.check_shapes.get_shape" title="gpflow.experimental.check_shapes.get_shape"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_shape()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>shape_type</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Type</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]) – Type of objects to extract shapes from.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>, <a class="reference internal" href="#gpflow.experimental.check_shapes.ErrorContext" title="gpflow.experimental.check_shapes.error_contexts.ErrorContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ErrorContext</span></code></a>], <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>], <code class="xref py py-data docutils literal notranslate"><span class="pre">...</span></code>]]]], <code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>[[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>, <a class="reference internal" href="#gpflow.experimental.check_shapes.ErrorContext" title="gpflow.experimental.check_shapes.error_contexts.ErrorContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ErrorContext</span></code></a>], <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>], <code class="xref py py-data docutils literal notranslate"><span class="pre">...</span></code>]]]]</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-set-enable-check-shapes">
<h3>gpflow.experimental.check_shapes.set_enable_check_shapes<a class="headerlink" href="#gpflow-experimental-check-shapes-set-enable-check-shapes" title="Permalink to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.set_enable_check_shapes">
<span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">set_enable_check_shapes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">enabled</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/config.html#set_enable_check_shapes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.set_enable_check_shapes" title="Permalink to this definition">#</a></dt>
<dd><p>Set whether to enable <code class="xref py py-mod docutils literal notranslate"><span class="pre">check_shapes</span></code>.</p>
<p>Check shapes has a non-zero impact on performance. If this is unacceptable to you, you can
use this function to disable it.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">set_enable_check_shapes</span><span class="p">(</span><span class="n">ShapeCheckingState</span><span class="o">.</span><span class="n">DISABLED</span><span class="p">)</span>
</pre></div>
</div>
<p>See also <a class="reference internal" href="#gpflow.experimental.check_shapes.disable_check_shapes" title="gpflow.experimental.check_shapes.disable_check_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">disable_check_shapes()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>enabled</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<a class="reference internal" href="#gpflow.experimental.check_shapes.ShapeCheckingState" title="gpflow.experimental.check_shapes.config.ShapeCheckingState"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShapeCheckingState</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>]) – </p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-set-enable-function-call-precompute">
<h3>gpflow.experimental.check_shapes.set_enable_function_call_precompute<a class="headerlink" href="#gpflow-experimental-check-shapes-set-enable-function-call-precompute" title="Permalink to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.set_enable_function_call_precompute">
<span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">set_enable_function_call_precompute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">enabled</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/config.html#set_enable_function_call_precompute"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.set_enable_function_call_precompute" title="Permalink to this definition">#</a></dt>
<dd><p>Set whether to precompute function call path and line numbers for debugging.</p>
<p>This is disabled by default, because it is (relatively) slow. Enabling this can give better
error messages.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">set_enable_function_call_precompute</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">buggy_function</span><span class="p">()</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>enabled</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – </p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="gpflow-experimental-check-shapes-set-rewrite-docstrings">
<h3>gpflow.experimental.check_shapes.set_rewrite_docstrings<a class="headerlink" href="#gpflow-experimental-check-shapes-set-rewrite-docstrings" title="Permalink to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="gpflow.experimental.check_shapes.set_rewrite_docstrings">
<span class="sig-prename descclassname"><span class="pre">gpflow.experimental.check_shapes.</span></span><span class="sig-name descname"><span class="pre">set_rewrite_docstrings</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">docstring_format</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/gpflow/experimental/check_shapes/config.html#set_rewrite_docstrings"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#gpflow.experimental.check_shapes.set_rewrite_docstrings" title="Permalink to this definition">#</a></dt>
<dd><p>Set how <code class="xref py py-mod docutils literal notranslate"><span class="pre">check_shapes</span></code> should rewrite docstrings.</p>
<p>See <a class="reference internal" href="#gpflow.experimental.check_shapes.DocstringFormat" title="gpflow.experimental.check_shapes.DocstringFormat"><code class="xref py py-class docutils literal notranslate"><span class="pre">DocstringFormat</span></code></a> for valid choices.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>docstring_format</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<a class="reference internal" href="#gpflow.experimental.check_shapes.DocstringFormat" title="gpflow.experimental.check_shapes.config.DocstringFormat"><code class="xref py py-class docutils literal notranslate"><span class="pre">DocstringFormat</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]) – </p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

</section>
</section>
</section>


              </article>
              

              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022, The GPflow Contributors.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.2.2.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>