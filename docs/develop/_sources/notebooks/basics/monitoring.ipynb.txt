{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "8a378ebe",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "3f0dfa86",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-21T11:11:30.996773Z",
     "iopub.status.busy": "2022-07-21T11:11:30.996422Z",
     "iopub.status.idle": "2022-07-21T11:11:35.268502Z",
     "shell.execute_reply": "2022-07-21T11:11:35.267823Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-07-21 11:11:32.011739: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-07-21 11:11:32.011766: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.inheritance.inherit_check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import reduce_in_tests\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dce0141e",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "788ad262",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-21T11:11:35.271800Z",
     "iopub.status.busy": "2022-07-21T11:11:35.271309Z",
     "iopub.status.idle": "2022-07-21T11:11:35.274827Z",
     "shell.execute_reply": "2022-07-21T11:11:35.274264Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3e0193e2",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "3f23d600",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-21T11:11:35.277284Z",
     "iopub.status.busy": "2022-07-21T11:11:35.277036Z",
     "iopub.status.idle": "2022-07-21T11:11:35.280039Z",
     "shell.execute_reply": "2022-07-21T11:11:35.279472Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = reduce_in_tests(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "4515bf5b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-21T11:11:35.282243Z",
     "iopub.status.busy": "2022-07-21T11:11:35.282013Z",
     "iopub.status.idle": "2022-07-21T11:11:35.385389Z",
     "shell.execute_reply": "2022-07-21T11:11:35.384624Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7fb3edb75450>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "f3a3897b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-21T11:11:35.388092Z",
     "iopub.status.busy": "2022-07-21T11:11:35.387779Z",
     "iopub.status.idle": "2022-07-21T11:11:35.441941Z",
     "shell.execute_reply": "2022-07-21T11:11:35.441357Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "2022-07-21 11:11:35.390750: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-07-21 11:11:35.390778: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-07-21 11:11:35.390800: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (ec81a0fa4f1a): /proc/driver/nvidia/version does not exist\n",
      "2022-07-21 11:11:35.391059: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7fb3ed8d5a20&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value  </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0    </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]</td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0    </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.01   </td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7fb3ed8d5a20>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤═════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value   │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪═════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0     │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.] │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0     │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.01    │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧═════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "b4e6a20d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-21T11:11:35.444666Z",
     "iopub.status.busy": "2022-07-21T11:11:35.444335Z",
     "iopub.status.idle": "2022-07-21T11:11:35.604231Z",
     "shell.execute_reply": "2022-07-21T11:11:35.603643Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "iVBORw0KGgoAAAANSUhEUgAAAXwAAAD4CAYAAADvsV2wAAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjUuMiwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy8qNh9FAAAACXBIWXMAAAsTAAALEwEAmpwYAABNQElEQVR4nO29eZTb53nf+3mxL7NgdnKG24i7dkqMbJmyLXmTYyc2YmdPT5qbtm5PmpMuudPraXpqu3UrtXN70940t4mbuEkax4ltyWM7kiPb8i5bEkmTEkWK+w6Qs2NmMNiB9/7xAJwNGC6zA8/nHJzB8gN+P8yQz/u832cz1loURVGU6sex2hegKIqirAxq8BVFUWoENfiKoig1ghp8RVGUGkENvqIoSo3gWu0LWIjW1la7bdu21b4MRVGUdcPhw4eHrbVt5V5b0wZ/27ZtHDp0aLUvQ1EUZd1gjLlU6TWVdBRFUWoENfiKoig1ghp8RVGUGkENvqIoSo2gBl9RFKVGWNNZOoqirA36j0Toe+EU0ViSzpCfnid3E97XtdqXpdwmavAVRVmQ/iMRep89RjKbByASS9L77DEANfrrDJV0FEVZkL4XTt0w9iWS2Tx9L5xapStS7hQ1+IqiLEg0lryt55W1ixp8RVEWpDPkv63nlbWLGnxFURak58nd+N3OWc/53U6e2NPGgae/TffHn+PA09+m/0hkla5QuVU0aKsoyoKUArMzs3Se2NPGM4cjGshdZ6jBV5Qa4k7TK8P7umYdd+Dpb1cM5KrBX7uowVeUGmEp0ysrBWwjsSQHnv625uuvUVTDV5QaYUnSK62FbJLORm/Zlw1i9C2lBeV1+l89DfnsvGP7j0Q0BrDCGGvtal9DRfbv32+1H76iLI6SjBOp4JUb4MLTH6z8AZkpSE1AJi73sfSfStD7YoxkbuaBtvhps+kK5HnpowXwN8kttJn+k4lZu40STQE3n/jZe3RXsAiMMYettfvLvaaSjqJUMXNlnHKEAu7yMkxqAuKDkJkEDLgDEGiBfJbwHidkEvS9miY6BY3uArFsecEgmnDAtSPg9Mhn+Orp+3o7yez8xWEskdXg7zKiBl9RqphyMs5M3E5DPJVjLCGSS0mGYfIa4R1OcLihvgs8ARiPwqWXYfBNmIwSzsQJ35UDazlw6iPEqCt7jk73FAydFjnIOMDlJjr10YrXpMHf5UMNvqJUMQtVw3aF/Eylc8SSs/X1ZLZA3/cHCXe3QSYBl34E0SMwegky41AoINKNQWQciGSDFc5i6Wn6IUyNgNsLOCEri0AkW36BAFl4+o9E1OgvMWrwFaWK6Qz5y2r3XSE/L338XXR//Lmy74vGC/Cj/w9Gz0JiCHJFsd7phoIFY6GQB4eD/tRDM0z/bJocKcJtUTD1ckA+A4UCPa0v03PtcbILmKBbkXa0i+ftoVk6ilLFVKqS7XlyN6Qm6KwrbwIcFOg+8lEOXPlH9CceBE8Q/I3grYP6DmjZAd3vgPt+nr78L2HLBGsNlk9sOw7+EHgbINgKoS3QtIXwhjHqnPMzd2ZyswyiUnxidlbQMc32WQD18BWliilXJdvz7m7CTVfg4Cv0dEzSO3UfSTvTFFjyyCIRKbTQm/hlaPsJ4c0paNsDG+6DDfeCR3rpRL9bfpdgMYQfewgmO2EiCtkpyCbAuKBhA7G876bXH40lYOI6NGyY99pCaabq5ZdHDb6iVDk3qmTzWbj4Yzj1R3DqPGQShJ1AS4S+0ceIFhpxULhh7EskrZu+4UcJ/+Y7JXg7h4VkI/Y8Dulx0fBjFyTwG7sKqRid3hSR9MIN2Dq9afjJX8Cu98HGB8BM7yS0i+ftowZfUaqdfA4ih+DYMzB0EnJZkWiMA5JjhN0vE95wEALNdJ/9nbIfEY0Xyhp7ENloburnDdnI4ZiRf78FEsNi9Mev0DMxRO+xDSQLzrKf6zc5eradg+wknHpedgnb310M/lZeaLSLZ2WWxOAbYz4L/AwwaK29t8zrBvhvwAeABPAb1tqfLMW5FaWa6T8S4VNfO34jbTLkd/PJD91iYZK19P/gJ/S9eIlo2kOn6yF6Ogzh5sswNQTpSTBOqN8IdR3QtIXOaIFIYr4BvpkR9bkdNwx+xWt0eaChU84V2kS4eQDqL9N3KEs05SLkymJxMJ5z0umK09P2KmHnJZhsg6ZuuPY6pMZh9wfA37jwQqOUZak8/D8D/jvwFxVe/2lgZ/H2FuB/FH8qilKB/iMRer70Gtn8dP5LLJml54uvATcpTIoP0v+3X6X3tVaSVjziSK6B3ujbIDlKuD4CgWaoa5MA7MYHYdN+elqZZ0QN8MSetorXOPf4dK6w8BdzOKF+AwRaCT/WRHjfCIxehIHXpNjLFRDDHh+AfB5ilyGXhPb7YPwqnPgK7Hxv+fiEZuksyJK1VjDGbAP+toKH/8fAd621ny8+PgU8bq29ttBnamsFpZY58PS3K7ZDKKVVziOfgzPfgqN/xYE3fppIrmH+e10TvHT316B5K3S/E7a8VTJpivyb/mN87uXLs9IsDfBrb93Cp8P33dI1Vry+cmSmIHYFkuMw8DoMn4VCVmIOyRikpyCXBn8DtN8NvnrwNcq1t9x1a+eoIdZCa4Uu4MqMx1eLzy1o8BWllqlk7KFCYHLkPBz8U7h6CPJZorn68p+bq+fA2V+h5/27Ce/eNe/175wcmpdTb4HPvXyZ/VubZ3nQSxI49QShbbd49C4P1G2UQq/EMLj9gAGnS7z+68ckeOtww4XvypW1bL/1c9U4ay5oa4z5GPAxgC1btqzy1SjK6uE0hnyFHfgsTT2bhje/Aseehanr4GkAX4hO12RZDx8MkYSh92vnwR0kvK9rVgFTpT2/hXkpj0sWODVGZB5fSILD3iAMnoDhc+LduzxSvJWMiZa/4V6gGS79iP4T4/S9NEY0llJZ5yasVOFVBNg84/Gm4nPzsNZ+xlq731q7v62tvG6oKLVAJWMPTAcmh8/Di5+Eg5+FqQHwtUEuA1PX6Wn6AX6Tq/gZpZz1uQVMCzHXc1+wsOtOcPugdRe07oTOfXKr31hMx3SBtx5SMRh4AxIj9J/N0/t3USKxlBZf3QIrZfC/Cvy6Ed4KjN9Mv1eUWqergpfcFHATfmADnHpBjP2lVyBvwekrtkFIgreR8NY0T91zla66+VWwJaKx5E0brM1kruce3tfFUx+5j66QH1O85qc+ct/iPGxjoHGT6PXte6DzAWjeAS6XvOYJQnIMrh+n70Qjyfzs73fbPf5riKVKy/w88DjQaoy5CnwCcANYa/8IeB5JyTyLpGX+H0txXkWpZiqlHX7iyW3w8v+Q4GxyWLJackkx+p6AdLdsaIeNDxHe8ijhps0Vg6udIf8t6+2VPPe54w+XDH9Iqnqdbsnscbph6BTkUuAKQnKEaMpd9q1afFWeJTH41tpfucnrFvinS3EuRakVyqYdPtpAePR/wZWD0qbA6RaN2+GS/PaGLmjdRf/UHvqezxIdf53O0Jl5Q8dh2oBXGo7SFHAT8LhWN+XR7YOOe+V7GgOFHIxdBiag4K8Yp9Diq/KsuaCtotQ6MydUlQK3XSEfPQ9kCA/9EQyckN7yDod4vq4ANG0VGaTzAfqHO+n97jWSWcmHj8SSPHM4wkcf7uI7J4fKGvCyO4m1MnnK6RJ5x+EGW5B0zUkHFCw9LS/TO/gESTvt6ftd0PMezdwphxp8RVlDzC1kKgVuI7EUvd/PQmOBcIMpGnovBNokF71pK3TcDe1309d/9IaxL5HM5vnOyaGyufHrooDJGGjbJVOz8nmRsDCE2wfAvkjf6NuI5urp9GXpuTdBeHNC+vY71mFD4KkR2b01bprVO2gpUIOvKGuIhQKoSevmd2M/x7+IGTpdk/RsPUe40yl56O13S2aLy3tHufHLpsMvNc3bRL4qZEXWooHwxlHCwf8JTie03QN17TDgETmouXu1r/j2mRqUPkdLbOxBDb6irAi3OqhjoWIrgHwxsS6Sa6D34gPQ5SS89QHpUVM0EFXfVCy0CXa+V6ZxRY9I1k79Bpi8BsMngaJnH2iSGbr1Hat9xbdOelKC0qGty/Lx63C/oyjri3KDOv7F3xzl3/Qfm3fc7fh0ybyDTx50QGPXLG9wyXPj1yINnXD3hyRnv5AFT5149tkkjJ6XjpzRYzB6QYzoemFqSHYwvtCyfLx6+IqyzJSTacq1Kuh74dRNC5/mEkvm581+XRea/FLQ2AUP/JK0kxi9AP5mGaGYGIV4FGwePAH6L0Dfy1NrvxI3l5H2EXUdyxZ7UIOvKMtMJZlmbquChXPHLVTw/8tNeFo3mvxiCW2Gfb8Gr/wRTA5BwyZJU50aA1z0Hxui9+LwjeKsUiUu3KTb6GqQGJafgdZlO4VKOoqyzDgXCL7NNPKV5ssa7IL/UWu+yKhlB9z/K9J/JxUT/dvlhswkfZd2rI9K3EIBEiPSBdTlWbbTqMFXlGVmoZ44nSG/5NRf+B49G4/gN5lZr/sdeUIeS2EBdb9qgrF3ijHQ+SDc/RHJzMnGpQCtkCeaqyv7ljW3SKZiUlQWXN7+YWrwFWWZqdQTxwA979sFZ1+EN75COPM8T9V9iS7HGAZLlzfFR+/KM5ap/N+06oKxd4rTBd0HYPu7iuqXAV89na7yAds1t0jGB8Hlk+Zwy4gafEVZZsplzZQGioRD5+HU30kP+/gw4eAbvLTjb7jwjh/Qs9/FM5d8C372Rx+uEa3+VvAEYNeTsGm/ZOsEmulpfXlex1C/y6ytRTIZk0KyuuVPH1WDryjLTLmOkr//Sw/y6YeScPoFuHpQhn843SJFdN4Pd72TvjeC8ypm5/LM4Yi2Ap5JoFlm3rZsh0yS8JYET7V9ky73lOya3HGeetQS3r2GPPz4IDi9MugdJI10amRZTrVkIw6XAx1xqFQbswqwfGl66r5JuPAtyb1u7hbvdPsTsO3tdP/eC7eUpnlb4wRrAWvh8o/gtS9AahIKGcmAqd8CiQHJ19/392Dr22SRXU1SEzB6Dho3Q7BVrn3opPxs23NH6ZkLjThUD19RVoh5BVgpL/98+IPsG/s0/Y73yGzZPT8Ddz0OThehwK0ZozUXgFxl+o9GOfBXKbp/9F4OvPHT9I/vAqdfWkl7QxAfgpPPwdCbq32p4t073BBokcdTQ1Jp29i1LLn4moevKMvE3HYKU+lcmT45hjFbR+/w+8DVRnjLIzdeudXN95oLQK4is5vPGSKZAL2XHoCtEPa+AjYALj+MnIMTz4G/RYzrapCOQ2ZSageMkcKryWvgbZD0zGVADb6iLANzu17erEdOsuDgU9+foO/lb99YIGLJ7E3Po1k6sylX1ZwsuOiL7CV870VIDIKvGWwOBo7B8X546NfBt7zZMWWZvC5SXsm7nyjGYho3LdspVdJRlGXgdsYGlhhLZGf126mUee80ZunGCVYZFTuFZvzSTM3XAulxMG7I5SU76tRzUp27kiRj4t3XbRDpJjUhufh1HbII5DI3+4Q7Qj18RVkGlkJXLzVTmKns+N1ONfILULFTqD8PmXixc2YOUnGRdvJpOPc9CeRue4fk8y83hQJMROX8wVYo5GH8imTqBNshdgkyU8WhL0vrk6uHryjLwFLp6haWdkB4lVOp5uGJvR1Q3ynefV0n+BuhkJZASTYBbz4P114TY7zcTA3KQlPqcjp+RaZ4NW2F5Kh4+sE2Ddoqynqh3ADychi4EdAtp9lryuXtEd7XxaFLo3zu5cs3dkYWeOZYjP1PvIuwpx+yU9KgzBYgPQXGJWmbp78uU8Q67lmW4SOASDXxAWl/7K2Xzp7JMajfCBgYvypB22Xq4a8evqIsA+F9XTz1oV10+XNQIZu+K+TnwtMf5KWPv4tPfuie6u9hv0J85+TQvN94Mpun79UMbHs78vew4kW73OLhF/KSuXP+ezByZvkurhSYbeiSuMH4VenlH2iFsYui34e2iMe/DKiHryh3QKUJVrMHkFvy1kmIOFP4yDJj0PYcY14zPexXgMojHlOw8z0wcRUihyHQLgVPY5fEwFrg+uvSddPhXvrxiImiXFO/UQx7aWEJbYXxy9LLv2W7LALZ5B0XXi2EGnxFuU3KpVz2PnuMQ5dGeeZwZMYAcpEFYtTjJkfQBVPFti5e1/z/yDXTw36ZWXDEo7cO9nwIEmMQuyiedX0HTA4Ws2OSED0qMo/DBaHNtzyeckFyGTHk7qBk4oxdlJ1F811SbJUah7qNUoiVnpAdwDJo+CrpKMptUjbXO5vn869cqajZZ3GRmNHDK5bM0vvsMe2DswzcdMRj8xbY8W7wNUA6IVq6t6FY6eaSxWDgOFz4Pv0/emPeeMrb/rtZC7HLgJXAbHyg6Ol3ys5iahB8TWLo05Pi8de1L9FvYzZq8BXlNqkkGSzU9x7mK/nJbJ7f/cJravSXmHLN6uZlN21+BDb9FJgc4IBgEzicYBwi58Svw+BJ+r51oeziflsDVOKDknPfuFm8+slrMo7R5S2mY/okDTOXFBkp0Lwkv4dyqKSjKLdJJcnAacxNjf5c8tau3ZF765ibymNOF+x8EmJXRdMPtEiefjYFnqBIMIlhoony2Tq3XGeRHIPJqGTlGCPxAndQzjF2UYLFpGSRadkxfe5CTto9LzHq4SvKbVJJMviV++vn9V6/FdbkyL1aINgCez4gg0fyWQh0iPySz4rcYy2dnlTZt95SnUVqXAy8pw489WLgPUGRj2JXxNsHWQDadstr1sLgm3Dl1WWpCVgSg2+Meb8x5pQx5qwx5uNlXv8NY8yQMeZo8fYPl+K8irIalJUMPrSbTzf8LU95/hwn5XX8hTK7tePlKtF+N2x+VIyvLySLQGoCbB78IXq2nsPvmP339LsdN0+XTU+KgXf7xeBPXBGj7/ZLRk4qJpJOsE08e6dbjP31Y9LF073w4Js7ZdGSjjHGCfwh8F7gKnDQGPNVa+2JOYf+jbX2txd7PkVZDcplaswqiDryl3Cin7BzjEPeu/nL9KPzPuNt25t5+fxYWdlHO16uEg4H7Hk/jJ2X4qv2e8VYT0ShdRfhznFwnaHv/FaiaR+d/jw9jzUR3uEUD7xcJk1iVLT5Ql5u8evSRiGXKVbV5iQoG9o8rdfnMjB0Sox942bY9MiazdJ5BDhrrT1vrc0Afw18eAk+V1HWBPP62M/N1Igegx//kZTFewJ8x5SdPcHFkST/5Rcf0AKrtYbbD/d8WLZgmUnY8nYJ3o5eAG8D4fYRXnr7CS6844e8tP97hN0H4dKPIHpEmqCVKBREwhk+DcniLiGfEe99IgLDJyUw3LwN2veKsbdWumYOHp8ehNKyHcYuLIuksxRB2y7gyozHV4G3lDnuo8aYdwCngX9hrb1S5hiMMR8DPgawZcuWJbg8RVkcldIw+144RfjuRvjuf6b/WjN9uf+baKIFW0G8icaSWmC1VmnZAVveBhd/CP6QVORe+B6MnIa2eyAzLlo7fsmbT0/A4EnJ4Q+0Sn4/DkiMyGLh9kvfnnwO8sVAcMc90NApaaCFguwEJq9LX53MlOTeN2+T3YWnbl330vka8HlrbdoY84+BPwfKNgix1n4G+AzIiMMVuj5FqUjlys0kvPqn9J+K05v9DZJ4F/yckmyjBVZrlG0HZCrW2BWRWzofksrbySvQskuCsJk4uOvAYcToT0RE/89nweURr71uQ7FXTlDuh+6VLpilISdTF+S9tiABY19Izh/skEXAOKS9wjKwFAY/Amye8XhT8bkbWGtnTuT9E+A/L8F5FWVFqFi5WeeAVz5DX+Zf3dTYq2yzDvCHoPNhyKbFuAfbRGKZvA51k9C+R3LqUxPS1rglKBKQt1EeZxPFntYG3F7x0p1uiQmkJ6fP43BJHr4/JI9HzknmjkE+o6l72WbtLoXBPwjsNMZ0I4b+l4FfnXmAMWajtfZa8eGHgDUwTFJRbo1ynS/9bgc9gedhcoCoban43lI3TJVt1gnN3SLLlFofNHTKKMKRM+BvkP42iRFpfNZyl1TFTl4Tb719j3jyWOmFU8jJ84W8aPdONzg9cjNGdgVDp+RxsE00/JkLwTKwaINvrc0ZY34beAFwAp+11h43xvw74JC19qvA7xhjPgTkgFHgNxZ7XkVZKebr7j56Nh4jfPmL4HDS6Z4ikq2b9z5tbbwO8QRFzsmmRYNPDEN9O4xH4NoxqYpt3SHtEIbPSGpl2x6RdiavyWJQvxH8TQu3WM7nYPS8BHZDW4oVt55lHW8IYOxtVgauJPv377eHDh1a7ctQlNmceRGe+UcSyGvaSf/ePnq/NzVnB6CTqdYt2SQMnoDUpFTKxq6IQc4kwOODjgegaRukxiQLZ8P90LpT+uxPXJOfLp80SStn+HMZGDkLhazsEOKD0lahZeeSVNcaYw5ba8umimlrBUW5Hcavwzc/JRqvPwSP/hbhB98CLUOaeVMtuP2SeVMoSPaNw0H/JQ99p1qIZvx0+jL0PHCN8N560eOHT0tGTfNd0LZLUjUnr8mowomo6PuBFpF0sknR7G0BmrfLDiI7Jbr9MrRSmIsafEW5VbIp+P5/lnxqlxt2fwD2fhBcHs28qTbqN0o1rHHSf62Z3hMuksUNXCTlpfegG8wU4a05CIRE0inkxej7Q3JLTUgK5+Q1MfyFrEg5vgbZESTHitOuOpdVt5+J9tJRlFvBWjj9TTj2rHhnbXfDo/9USvGV6sNVDKQWsvS9krhh7EskCw76jroBI5LP1Ki0VR4+JYYexLA3dUuf+9SEtEhOxUTSiR6F0Yvi+S/TOMOyX2vFzqQo65mxS/DipyE7Kdv9t/02tCzxRCRlbVHXAYkRohPlG+JFUy7ptBlsLbZMSIOvESauy4Byt1/SMW1ejHrXPsil4Nrrkm8fbBVpcOScBIvdRUknE58ear7EqMFXlJuRSdD/7F/Rd+23iNoWOgtpeqb2EHYtnHuvrHMcTqjvpLM+QmRyfkO8Tk9S0jdLlbXxAUnlzKZg4JikaG64TypofY0wNSyafV0HdO6T1M7kqAR60+PTqZwunzgVoS1LPkxdDb5S8yw4wq5QoP/rX6f37J4bxVWRtI/e5y6Bt1F1+2on0EzPYy30fnOIZG46o9HvtPR0X5JAbPwaNG6VbpiNm0XHn7wuQdvrx6RTZiYhsqC/CQJNsiMo4Q2Cv1HuO9xFI2+W3NiDGnylxqk0nxaK+fdDp+l7NUWS0Kz3JbMF6aWjBr+6MYbwW3ZDIUPfywmi4xk66530PFpHuL4JxqfkuMmIePGZCShkoHGLeOixy6Lvt2yXIi6HSwy50ztdiOXyLUvfnHKowVdqmgUbo90Tgh/+v0TzHyj7Xu1hXyP4Ggjfv4Hwninpn59PSx59eq9IOMmYFExlM4BDArRNThlq0r5XvP1CTtonrHKQX7N0lJpmwcZox78Kp58nRLzsMaHA8vQ7UdYgDZ0SfI1flwBrKW9+w4Pyc3IQfHXirU+NyM3fLIHZtj3SIXP8cnGs4dK3Pb5V1OArNU2lwSOd9S740R/Sn7iXOOWPiadyOoC8VigVY00NS1DW1yBZNL466LhPWifHrohkYy1EDku1Lsj83JbtktufLKZuZldnd6gGX6lpys+nddDTfhhGz/DJ7K+RraB8ZgtWZ9HWEvUbJCNnMiqP/U3SGqGuHdp2FscXXpFOmfm09NYfj8x+f8sOKdAaOiW7gBVGDb5S08yfT+vjqYcThMf+F/2ZtxCjfsH3q45fQzjdklKZGp9udxxoFk+/uVv66zg94uk7fdIj5/z3Zxt2b30Ziaf8DOTlQIO2Ss0zqy3C8Dn44m9CKkZf/hdYePS4zqKtOYJt0hFz/KoYbmOKDdIcct/hgqGT0k7B6ZU2HHWt0mCtVFFbkngmB2S3kEnIYqG9dBRl8SyYZz+TbApe+gNpe+twEy00Lfi5OtSkBnE4pIp29Lx48CUj7muU/HuM7ASuvyHVtOk4XH5VhqTkUrOLqeo7JAA8dlEasDVukiDvMqIGX6lqbppnX8JaOPkcnHlBsjEat9BpDZGp8p/bpR0xaxdfo9zi18W7d3nkeW+9aPQg0s7QKQncDhyTRaD77dJOualbvHyQbpxte6RIa/yKpHi6A5LL37RtyS9dDb5S1SyYZz/TWI9dhh//kWRReIKw+wP0NO2k92vntc+9Mp+GTTD0pvTSab5r+nlPQPLvHS5J0XT74OKPIXJIeuQ0bRUpp2OvVOaCLAL+JmmzED0sUlDbbnFCtLWCotw6lYKqkViSA09/W2SeRh89HT8hPHwajFNG1d3384Q7d4E7qH3ulfm4PJJmORERr3xme2NX0WC7/dKPxwLRIzIly+kWCSdyBFq3S3qncRRvTgh1i+GfvA6tu9Xg3xRrJYru9KxIEERZ21QaQG7gxvOR8RS94zvA+yDhxvPwwC9Bxx4A7XOvVCbYJjr9+NXiwPIZ5tThlMwdb4N4+qkYxC6KXNO2W9I1xy5A012Sy2+ccnMayfyxhWVpt1B9aZnWSv+K+MBqX4myBiiXZw/idM0kiYd/nf51DsT+Ld1fbOVA3w+0qEpZGGMkCFvIibRTjmALbHwA7g5LX/yh0yIbllI4E8PgDIjUU78B/C3SIz/YtiyXXH0evsMhke74gAwaKAVUlJpk5gDySCyJYb6xL5HASyIjW+iKwV1FmYknILn58evgC5WfXOX2iWb/wK/CsS+IpGMR3X5qEM59S4q3Grok8OtrkDjSMlB9Hj5ICTRGxospNU94XxcvffxddIX8FY29MFsvLQV3FWVB6jeAyy/STr78sBRAqnF3vx9C20TyKeSgdRdsvF9kn8yUPA/SJtku/K/1TqhOg+/ySNpUYmRVGxUpa4s7qYrVSlrlpsyUdmKXFj6udZcEaxs3S0O2VAyS42LgPXXFtsleyehZhn741WnwQbZINi8Rb0XhzqpitSOmckt4AiLJpCck7bISvgYZllLIiqSz8/3TFbtj5+HCd2HwTXltGaheg+8JSge7+OBqX4myRqgUwF0I7Yip3DJ1bWKoJ6PTg8zL0dgpccbEMCSGoOtB2PuzsP3dIvcMvQmvfxFyC8hDd0j1GnyQX2o+LWmaSs0T3tfFUz+9iS73FAaLg5vLfdoRU7ktGreInh+7JEkj5fAEJdBrHKJAJEZFhm7dAfd8GPb9PdjyKLiWPqemug2+v0m0sanh1b4SZS2QyxB2vcpLoU9yoeGfYm/SGK2E6vjKLeNwSMqltTB6rnIQt6FTsnqySSneymdnv7bpoeW5vGX51LWCMeLlpydkQrxS2wyegCN/IU3S3D46XeUnWc1FO2Iqt4XbJ0VXubQY/XLtj11esU1Or/x7nDnUfBlZEoNvjHm/MeaUMeasMebjZV73GmP+pvj6K8aYbUtx3lsi0IKkaKqXX9NMjcDh/y0Vjg4DvgZ69ntwOxf28rUjpnJHeOvF6GeTMHqhfLZgXYcYfodLZOfk2LJf1qINvjHGCfwh8NPA3cCvGGPunnPYPwDGrLU7gN8H/tNiz3vLON2Sopkc1RTNWiWfgwsvwdlvyH2XDzY+SPiDH6Dv5x+gaUYmjt/toCngLg5D8WujNOXO8TVKumZmUtopz5V3XJ6iQwo4PDfP418CliIq8Ahw1lp7HsAY89fAh4ETM475MPDJ4v0vAf/dGGOsXYbKgnIEWyXfNRWTPhVKbTF6Fg7+T0hPTW+lD/wOuH3aK0dZXkr2JnZZet43d0tTtRJ1HVIv5HLLIJTJqCwSy8RSSDpdwEwB6mrxubLHWGtzwDjQUu7DjDEfM8YcMsYcGhpaokpZb31xmrzKOjVHahyO9cPIKcmKcAdg18/AxvtW+8qUWiHQDK07pSHa8GnJyinh8ogDkklMF4umby22dCesuaCttfYz1tr91tr9bW1L2EAo0ArZKfnFKrVBIQ9Xj8DxZyGfF+++aTO85R/QfyTCgae/TffHn+PA09/WXHtlefEEpUtmKWVz5JwEa6GYolmMJTk9EsBdJvFjKQx+BNg84/Gm4nNljzHGuIBGYGVHtgeaxcNLqJdfM4xdhsN/JsEwp1d2eg//Jv2npDFaJJbEMt0oTY2+sqw43eLpN2ySvjlDJ2XgeS4F/mbZjQba5PEydftdCoN/ENhpjOk2xniAXwa+OueYrwJ/v3j/54Fvr5h+X8LhlLzX5NiKTolXVon0JJz/PkQOQsGKRtr1MOz94IJTsBRlWTFGKnLb94oTmhyFkbMiN09EYPSMeP5DJ5clyWTRBr+oyf828ALwJvAFa+1xY8y/M8Z8qHjYnwItxpizwL8E5qVurgjBVtHRkrFVOb2yQhQKMHACjn4OsmlweyUb4tHfAqerYiGVFlgpK4bTLcHZjvtkxm2gSXagk9dlUfA1LcsAlCWp3bXWPg88P+e5fzvjfgr4haU416LwBEVDSwzLYAKlOpmIwPGvwvglcDrB44ddH4AN9wCVp2BpgZWy4jgc0kPfHxKpZ/CEDDafOSd3KU+3LJ+6lgm0QDahwdtqJR2HKwdlqEQ+Bw4P/TzBgR8/eCNA+8SetnlN1LTASll1nC7p8psaF41/Gag+g2+tpD1V+oXdCN6ubMxYWQEKBRg+C8e+JP8GjJv+3Fvpvf5OIuPpGwHaZw5H+OjDXXSF/Fpgpawtgm1SeTt5fVk+vvpGHIJs6T11UuQwlxvB21HpX70MOpmySkxeg3MvwvXXxfj76ugbe5Jkfv4kq++cHOKlj79rlS5UUSrgcEqaZnpS/g0vsX2qPoNvTHFW5LBs6Z1lvmKgRQx+cky1/HVI/5EIfS+cIhpL0uh3YwzEElk6g9ATOEc4l5QGVnUdRK+X1+U1QKusWera5bYMVKd7G2gBbOVmRN666eCtsq7oPxKZlUMfS2YZS2RFrpmC3qH30p95RP7Gez5QMRCrAVqlFqk+Dx+kV4U7IDp9XYVq3UALTFyV4K0nsLLXp9wx5XLoZ5LEwyenwvRlDNG/DRIK5HA7DNnCdNmHBmiVWqU6PXwQg55LVs7G8Tdp8HYdcitSTIwgkWwQC4wlsmAg5NcOmIpSnR4+iEGfiIhBL+fBO13TlbcavF03VMqhn83sIG02bwl6XRz9xPuW78IUZR1QnVYuk4BCrtgHf6xyiXKgBWxe2iYr64KbDyIv37FDg7SKUo0GP5eB038H116/uUH31mnb5HVGeF8XT33kPrpCPgwQcqRoMnEMli7nOE2e8gZfg7SKUo2SjssD9RshdhE67pEuiYnRyoNPAi0i/WSTswcTKGuW8L4uwt0WXv8CvPZ5mBoCbwh2vZf+tn9M79fOzgrsapBWUYTq8/BBOtFZpC9FoEVGjJV6T8/F3wwYDd6uYeb1rj90QXZwZ79N/9g2Dkz8e7oHPs2BI+8Ct7+4A9AqWkWZS/V5+CCNiBq7ZNBA83ZuGPTGMv/pnS45PjEK9Z0avF1jlPLuSx57JJakt/9N2HoEBhvpTXyUJF55LV6g99ljPPWR+7SKVlHKUJ0GH6BtT7G/9PnpvtP1G8sb9ECLBHd15u2ao2zv+pyl72I3FDbfMPY3Xsvm+d0vvAagXr2izKE63dlcGrwN4rGPX5GxYYXcAsHb+qLWr7LOWqNi7/p8A1FbfnHOW6sTrBSlDNVn8At5uHoYRs/JDEmbl3FhNzPogRbIxCtr/cqK038kgsOYsq91mlE6neMV36sTrBRlPtVp8AeOSU90pxfqNoi0Y5wLG/SABm9Xg0rDxEvafb7MJEw/aXqCL9Cz7QJ+V/kFATT3XlHmUn0avssjY8OuvCxefst2uDwE6QnpM50YhsZN89/ndIOvodg2uXN6iryybJQLyPZ88TU+9bXj0hKhDE7yPOX/POGNcXj4LnjoXn73S2+UXRg0915RZlN9Hj7AxvukbcL1Y4CR/tKJYZF3EqMLV94upPUrS0q5gGy2YCsae4ACDsKhC7D1bdD9TsIPb+G//OIDOsFKUW6B6jT43nopukqOwdhFyc4p5CWYm8+IF1/2fQ0S4E1UeF1ZUu5Ecul0jMGmh2HbAdmJMbP6VnPvFWUhqk/SKdG+F0bOwMhZCLbK6LDMpHj5U0Py3FyMkUKs+HVp0eDyrPx11xC31ghtGj9petoOwab9sPmnZslu4X1dauAV5SZUp4cPose37IDslIy+89bJvNtCQcaHpSbKvy9QnIBVaRegLBk3b4RWwtJlRniq4SuE72mEu94huzhFUW6L6jX4AK27RcuPXRGP3R8SrzA5Jl5+OVwekXYSI7JAKMvGXCkm5Hfjds4OlvtNjv/q/zNeavwU4Z1u2PIoNN+1OhesKOuc6pV0AAJNENoCw2dEznF6ZeiJwwnxQemD7/aVeV+zaP/pSdkpKMvGXClm5rzaTm+SHveXCTsPQtte6HpQ9Hune/UuWFHWMdVt8EF66UxcE4890CZGH6QlcqUUTV+omMI5ogZ/hQnv6yK83QGv/TW88WUYuyBxla59sPUxicUoinJHVLekA6LJ17UX9fssZOPg8oLTCWOXIJ+b/x5jZGJWarz868rykc/R/71XOfCNTrov/SsOxP8j/b4PQ9d+aN2u9RGKsggWZfCNMc3GmG8aY84UfzZVOC5vjDlavH11Mee8bRwOaO6WStt8pmj48+BtFFmnkpYfaAGs6P3KitH//Vfo/bEhkq3DYogUmum9/FP0j9+lgVpFWSSL9fA/Drxord0JvFh8XI6ktfbB4u1Dizzn7RNohbo2ydAxTpFy3AFpjTx8pnwhltsvx2irhZUjOUbf94dIFmZn7iQLDvp+oFlTirJYFmvwPwz8efH+nwPhRX7e8lCagoWVgK3DA6kxqN8gjdXiA+XfF2iBXBIyUyt6uTWJtXDhh0ST5cNKkXFtaqcoi2WxBr/DWnuteP860FHhOJ8x5pAx5mVjTHihDzTGfKx47KGhoQpyy51Q1y66fCEHnqBU07qCoucPniifgulvlh2BzrxdfgZPwZlvEDKVF1dtd6woi+OmBt8Y8y1jzBtlbh+eeZy11iKDBcux1Vq7H/hV4L8aY7ZXOp+19jPW2v3W2v1tbUuYkeEJTvfKcXvlcewiNG0THX/y2vz3OByySCTHNHi7nKQn4dTzcPlV7AK1D9ruWFEWx03TMq2176n0mjFmwBiz0Vp7zRizERis8BmR4s/zxpjvAvuAc3d2yYsg2CrGO5cW733sAjjcotdff+NGb5Z570kMS+VtXfuKX3LVYy2c/wGc+SZMDTJOXcVDtd2xoiyOxUo6XwX+fvH+3we+MvcAY0yTMcZbvN8KHABOLPK8d4a/STx7kCZp3kYYPgUtu8Sgj12c/x63Hzx1KussF6Pn4fiX5adx0umKVzxU2x0ryuJYrMF/GnivMeYM8J7iY4wx+40xf1I8Zi9wyBjzGvAd4Glr7eoYfGPEY3d6JUWzvgNyKbnvbYBrx8pn7ARaIJ+u3H9HuTPSU/D6l+DqIdl1Bdvo2RHBbebLOm6n0XbHirJIFlVpa60dAd5d5vlDwD8s3v8RcN9izrOkBFpg8rpo+aXumKPnoON+iB6C4dPQvmf2e/xNMjUrMayVt0uFtXD2W3D665CMyc5r4wOEN4dgWxuf/N44saT0xW8KuPnEz96j3TAVZZFUX2sFa4vjDT3gq5Ngq8M5nVfvqRMDnhgFjPTbScUgHZN8/aGTEsid2WPHGFko4gPaNnmpGDwJRz4Hk1FwuaFtl9yathB+6EHCj3tX+woVpeqovtYKtgDjV2HoTTEq2YQsAokRiF2CweOSFZKekEXB4QJfk3TUbNwM+awY/bkEiv3ztRBr8aQn4eBn5W+UK8jc4Y77obELOu6VVFlFUZac6vTwm7ZJSqXLJ4VTxkirZKzIB8lR8epT41DfKb3ys1OQHIFguwRvm7ZJO+USM9sm12/Qni53SiEPR/8aLv1QFmNfI3TeDy3b5Hdev2G1r1BRqpbq8/CdLmjeBlgx5KGtkE1KNk46Lgal4x7o3Cc6fnJYPE5PHUyNiJG3FgbfnB/ADbZKAzadeXvnXH4Fjn9FFk6HD9p3Q/s9IrNtuFcXUkVZRqrP4IP0sw+2TzdGa98rBn3iKoycE9mmcTO07AR3UDJ14gNibDJxee9kVG4z8TVKhs+Uyjp3xHgUDv4ZjJ0HDDR2wqafkkW2fe90yqyiKMtCdRp8kCIqTz3ELkvaZcv2orc/JRp9elIKqbx1oh8bl1TbJkbA7RE5aOi07A5mEmiRYSpzn1cWJpuCI/8boochl5XFc/N+6W8fbJPFV1GUZaV6Db4xogk73VLUk0uL59+6W6prR8+JPGMc0ht/00PSNyc+CMlxWSxSsfnFWIEWwGjw9nY5/Xdw+gUJlnsCsPF+KXjz+GQouaN6/ykqylqhuv+XOV0y8craopSTk3TL1l2Sfz81JLr+1Ag0boEN94PNw0RUCq2cPtkhzJRwnK7ptM5CfvW+23oicgRe/wL9Ax0ciH2C7oH/wIHjP0t/JFjU70OrfYWKUhNUp8HPJqe7X7p9MvQ6nxFPv1AQb7Jpq8y0dTilidrUkDwX2iavJ0bF6GdS8r58dvrzg62yMOhwlJszcQ2O/iX9F5z0Tv0ikUKTDDZJuug9GKQ/ooVsirJSVJ/BL+RlqMnQSTHatpit07RN9PvYxenFoK5dgoUOF0QOS2FWY5cUaXkbi73w4xLQHb86fQ5PUIK98bK94pQSmaTMpr3wI/ri7yPJ7IK1ZB76vnF6lS5OUWqP6jP4DieEtgBGCq2GTkq+vT8EDZvk/kzj7WsUDbmQhetHJUPHUw8OIwPOcwnJ3R+/Ij9LBFuL/XXGV/TrrRf6D1/hwH96ke7ndnIg+ltECmWnXxKJJbXPvaKsENVn8KGY5rdHvHoQSWbs0nS6ZmJ4tndevwFad4pBj1+Hhg1iyIMbROJJDsN4RPT8km7vb5Lgr3bRnEf/kQi9X36dyJS5MZd2oez63mePqdFXlBWgOg1+CX8TtO2R0v3kqHj7vkbwhYrN0GbMSW3oEomnkBW93uWD4ZOw+REx/BMR8fJLuwNjJJ0wPaEpmnPo+/pxknPmxVgMpsJ8nGQ2r8NNFGUFqG6DD2KYGzZKZg5GKmhtHrJp0e0HThS7Z+YhnweXX/R5TxASYzB+GbY/Lo+Hz8jjkrQTaJG0zlKBlwLpKaITmbIvVZ5lpcNNFGUlqH6Dn01BfKjY6TItks3VQzLEPJuC66/DwHGpqs1MyuNS64TMJER+Ij10tjwqi8SVg3JMfEh2A76QjkAsUcjD8S/T6Zos+3JXnZOukK/sazrcRFGWn+prngYiySTH5JZNyHNOLwRbpKVCclQqbX2NsgNIT4C/BZq64dpRcUUDzRK8vfRj8eA3/RT4G2WHkJkSjb9xk7RLnrwm6Z7N2+Q9zur8td6Uc9+D4/084djBX/IYzFHun9i7gf13tdP77DGS2ekaBr/bqcNNFGUFqD7LVCjA4Alpk+wOSGaOr3F2D/u6VimmGr8iLZI99dIpEytGPz4oaZmt2yF2QWQffyu07RUDnxgW3d7bCEGvLABj5yXd02HkfHUdtdUb5voJ+r/1XfquhIkUQsw19gDfOTPGpz+6D5CB5NFYks6Qn54nd+twE0VZAarP4Dsc4sW7A7OHmMwl2CKLwOgF0fS9DeLJZ6YkQJuKSY7+gX8Jr30OUqPguQc67oYL34foa2Lwtz8uBn74tPTMd7okcydVbM9Qv0HqAKqZiWv0P/c1ei/tm5drP5OSTh/e16UGXlFWgeoz+CByzK3grZdg7uh5SbvMJaSPDka6a9ZvlLz+He+FU89Jhs7mtwAWzr4I578jQdsd75bjM3FZJOo6pNdOfBBGzojO39C5bgd79B+JVPbIU5Pwkz+n79ymBY09qE6vKKtN9Qdtb4bTLZW2qZgEcTvugZYd4uXHLskxzd0yiSkxDCOnYeM+uOtxwMogj3MvihefT8vnOJzFKt67ZdFIT4j2PxEtPyR9DdN/JELvs8eIxJJYpFDqRt58PiuVtMeeKco4lVGdXlFWn+r08G+VbArGLkj2zua3iIeenpAdQmIEokfAG4JgszT5Sk+KXDN6VhaGXAoih+Q4p0c0fOd1yf8HkZfqN0j65kRUMoWSYxLs9TWu6le/VfpeODUrwAqlvPmThF2vwuE/o398B4bKaZddqtMrypqgdg1+alyqb40Rj95bB7ZdPPupIcndHz0vWTttu6V4q2mbVNum43JMy25ZJEYuiHTTuBWGTkg2T0Pn9LmcbmnMFmgWWWj0vCwKjZtlN7CGqZQfH42l4Md/AIkx+pK/hS0TpDXA7//Sg2roFWWNUJuSTmpCgrUur/THLwVVTbF/TsMmyfJxBSW/fnJA+ufXdUjbBuOk/8QEB/70Et1/08SBl+6n/0xOmoUZF1x9VWICc+Ubb/2Myt9YcRBLfKW//W1RSXfvdE3IjsXXQDRffrdiQY29oqwhas/gpydFxnH7xbN3lQk01rVJS2VfPWQmpM1CNimafiFP/5vj9H53ishkXnTtpIve4130H7sumUFOnywQw6fmt124Ufm7EzCyM5iITnfwXGP0PLkbv3v2LsRvsvT4/1YC1XXtdPqyZd/bpUFaRVlT1JbBT8dFTnF6ZTDKQnKKr1EGouTSMq3p2utw8Udw7kX6DuZIzpl9ksw76DvZIsM+8llJCy3kJV1zZpfNEp6gePuBFvGUR85Kjv8aopSdk8zmcRaHi3e54zxV/wzhxgty7e176dk1iN8x+xeiQVpFWXvUjoafLQ4ycbhlvm2lathsUhaG+DWIHBWdP3ZBJmS13w11bUQz5fP7o2kvXD8mRVibHoEtb5WxiWMXILtBPPuZOBzSytlTJ0VgQyfl8RqYAFXKzikFbPPW4jc5evzPEW48J/JUaBsE2wh7B6FpK31HnEQnMlpMpShrlOo0+KVmaFjR4gt5kWMs0LZLZB1jxBgbp7RfyExJADaXloVhMipSTvfbIfdTos83boSGLjobTxEZT887bacvJ1k5Y5fgza9Jpk/3O+UzJwdEugltljTQmTjdMsR7/IosDqnVD+iWzc6xLvqmniTcFpVYR8tdUrvQ+TDhjXcT/uktq3S1iqLcCosy+MaYXwA+CewFHrHWHqpw3PuB/wY4gT+x1j69mPPelPggYt2LmSOxy2LUGzeJfAKSUpmakDTMQr44zNwrBtfmINQtkk5dK2QSsoi4vJAYpuftrfT+XZRkblp397ug550boe1t0LQZLr8qFbmpcQkCGyMtH4KtEjtwl9G3nV4J9MauyLU1bQPf6owArJidk2+UnUrbHvmdbrhXbiE19oqy1lmsh/8G8BHgjysdYIxxAn8IvBe4Chw0xnzVWntikeeuzMb7p++PXpCxhU3d0vo4MSyeN0baKTRslJ+5HFx6SfLp2/dJ64VsHMbiElAduyi6vD9EuDUG7/TR90qaaLxAZ72TnnunCG8cBQLg8Ere/rWjMPCGVNo2bRVPPj0pGTztd4u0ZIzsAEq7jEIW8k4Zuj52SYx+2+7yweVlpDPkJ1LG6He6p6BlD+RTEnjueliNvaKsExZl8K21bwIYs9A8Ix4BzlprzxeP/Wvgw8DyGfwSU8PS094TFCOfnpDn3UHJk/c3iWwyNQTRlyQrZ/f7ob5DjisUZCeQS4mxjl0WL9/fSLjjKuEPZkQyaroLsg4J7HqD4r37Q7DtMRg5D1ODcj5PHdTXS67/lZelt/6G+2QKV8mTt1YMfygGw2dh8LgEdNt2icyzEh5/Nk3PXZfpPdJE0k7/E/GbHD07okBegt5b3irGfuG/v6Ioa4SV0PC7gCszHl8F3lLpYGPMx4CPAWzZsgjPMT4E0cNitBs2gvUU8+ibZzdVS47BxZdEy+9+JwRmzF51OMATkJsvJLKPcULnPtH7B07A0Ck5T6BFFgyLGHynSzR5bx3kiy2U3QF5reNukZbGLsrP1t2yC6nrkAXFWye3xk2i/Q8cl9YM41fluWC7nM9x60lWC/bDmcnoZTj0J4TzZ2BDB31DbyGaq6fTFadnR4RwZ1wkqbsel2tWFGXdcFODb4z5FrChzEu/Z639ylJfkLX2M8BnAPbv33/7yeml9sjDp+Xxxgekr423fv6xqXG4/Irc735suiVCORwO8dJHzkvw1d8kfXJiV4vtlEOw52cl0yYxLAVYhQLEfwKTg5JyaZzAVlkMmrfL+4fPiOwzNSTGvDR31xOQ89Z3iHEfvyqB57FLslvxhSQeEGyT3ccC/Jv+Y3zu5cs3Wh+U+uHAjMKofFYawp38W2mIli8QDrxBuOtwscncTglIN++WZnHBtlv5ayiKsoa4qcG31r5nkeeIAJtnPN5UfG55cDhEDw+0wMYHpc1BOVITED0qcs2m/ZWNfT4nC0NyTLz6iSuir3sC8tjlE0M9ekb09y1vFQOZT0ssYcN9cPQvxZvPxmXiVtM2iRs03wXb3g5Db4rsM3RaFpXEqLwebJV6AKdLhqsEW8XwJ0ZlZ5CKyQ7A3yjf19swT17pPxKZZexLlObIhh/YCIMnpQHc9dfBuOUzpgYltuANyvU2b4PmHTdfGBVFWbOshKRzENhpjOlGDP0vA7+6bGfL50Szb9xc2djn0iLFpMalnXFDGWkinxUZJjEK2OLErDYJ/F59FQoe2T0EWqCQk4KroZPFbKAuuY5ETD7/8X8Nhz4rAeTUuCwYDZ3y+QPHJBvI2yASUHxAUh3TkzKG0eUTGcrfJDJP225ZfOIDxWPGITslxV1OT3FIe6MsOsbQ98Kpik3NorEkHP0r2Q0lRqR//8RVyUjKpeXcLbug80H5Hl37amuoi6JUGYtNy/w54A+ANuA5Y8xRa+2TxphOJP3yA9banDHmt4EXkLTMz1prjy/6yivhdEnKoKmgb1srhnfymnjmzXfN9ooLBZFX4tfl2GCrGFxPQIKpyTEx/N4G0bJLckpdh8QKxi4VK2atGOQL34PQVtj7s3D1oEhAiWFJ9QxtFaN+6SWRcUJbJPYwERWDXWgGd1aKwaYGpWjM11DcHewo7hgG5bPyaQkgx5NFSckJnuCCw8E7fRmJDxQKssCNnJNrtnmJc3Q9AtvfDg1boH13+VRSRVHWDcau0R4uIBr+oUNlU/vvnPGI9LhxuCV/fKY8kc9K0VU2IV5yQ9f00JLUuMgyDrc8P3ZBMnGatk2/Px0Xb9kWZCHIpopy0Kh4yzggPS7e/9gFMcob75UFYiIqHnrLTvmsxJC83xMQz9tTB24//Wez9L0yRXSyQGe9i553biC82y/nyaVkkbLZYoZRmgNftEQS8xc/g+X3tx8lXHdCvPtsSnYq1spis+0x2Pk+8NVJvGGh6WGKoqwZjDGHrbX7y75WUwY/NS5STjImOfAt26dfyybF2Bdy4nnPbG+QGpddgdsvxs/pgolrsgto2TEdEC5V9E5EZAZuPgOZSfns5Lh8dnZqusJ39JwY+bZdElgeOC6xhWCbVOTmC2DTkJX0z/6LDnpf9ZHMT+9I/E546m0Q3umS82cmZeHJxCGfof9qHb1vdJEsTFftGixvC0S4mGmYzsBpP0g4eFzGNO54t8QfvHWyA7pJUFhRlLXDQga/OlsrlCOfm+5lH2wXOadEakI8bodLRh7OlC5KrZRL3TVL7Q7qOsRzHz4r2SuZuEg+WMlyGY/IOYwRI59LSh1AJiGpm4GQfMbEVbj2mhSGbXscMuPSj+f6sWIr5mIFcN0G+t5Ik8zPaXeQh74jhvAerwhmpSCvww0ON+HuDDQN0XcwSzRh6PSkeKIhwjMj227k2Edy9fReeztsqye8s7u48wnJNd1G6qeiKGub2jH4k9HiYPGAaO0lqaY09crpLTZVm+HNllopu3yzu2vm0qLzpydF5kmNicxT1y7SS/MO0cPzGfnMDffL4hC7KovO8GmIZ4rFX83SqO3yK5KiufmtsOVRyb5JjorMlE3CtaNEJ4stlecQjdvpAHWhIItPakCKzrJxwo7rhO8ZFJ0/l+bAmz83q6AKIGndfCryEOEPbZXvEmjRgipFqTJqw+CXRhMWcmLI6trl+UJeZBzjmC9dZKamWym37BCvOZ+VDJbEiBjDunbxpMu9v2Nv0bAPSA57aCs0bpFsl+ZuuHJQDHpDl7RxmLgui8SJr4j337pHjLjDJTJLwwY6A3kiiflGuNOfg0s/FoOeTYoOn09Dutiugbx8V5dkGkWzgbK/prGMk/5oM+GNrUv3u1cUZc1Q/Qa/1IwslwZPgxQ7lTzXsYtFL3zOIJQbrZRd062U44OS2WOtLBr1G8TAN6QlHTN2eXZMwOWVRWDkrHxWSQ4KNEuufkOXZO2kJiQg2tgl2n18CBIDkq7prQNPI2DBQM+uNnqPbZit4TsK9OwZFZnI6RPDnp4sBmGzch0uN/iaoL4dvM10+rJEUuV78/R98wzhhzeXfU1RlPVN9Rv8+IBkrzicUkRUCsZOXhdNvXHz9IhDkIyZ0XNAcdattaLTZyYlHbJx07QcBHK/fqMEahOjYtBLeIpFS6MXZHGZmQIaKhrVqUHJ7Z8aFtkpnwKnUwLLuQzkixk+3iDhjmHIpuk7t5FoykOnN0PPtguEA1dhMF3MsilI8ZQnKDsDT1BaOhgHxIfh8iv0bNzMP7/wEGXloQXSOBVFWd9Ud5ZOLiNtFgCwEoT0hyRwOnx6flplIS86ej4jMkwuLZ47VlocB1vKn8da8eSzSZFs5ma1JEYle8fbIOcrxQIKBRlxmEsVFwOHtGEYvyLXkRiWhSCbkJbNxiW7Dmvl2mweMdrFVtDGyOLl9MqOxeGWl7MpCRyDzNNtvosHv+Qnlplv8J3GULBWh5goyjqldrN0JqPFO2a6g6W1YsQdLvHuS5RaIJeMbzouGTTuoLQ2nunVz8UYKZoqJ+3AtNdfCtg2dYuM43BIMHjkzLTs09Itt22PSc7+xDUJ9k4NiIeeGhMj7vLJdzBucDrAmulis9Iuwjjle9u89N5p2Fj09Af55Dsb6f1unGR29qD1fNEBKNtvR1GUdU31GvxMQqpinR7x2OuKLY/jA5Ii2dQ9e6LURHRa4snE5Thfo4zxu5XURJcX6jtlkYgPTgeGSwSa5VrGLhSN/tbpFMqWHeLRj5yT+56AnNPfJLeOu2X3kJkSfT45Jj/zxfbMjqLn73DL7qLU1dPhkO/idItslJ2SGEFDJ+Ede6F57EYHTYcxN4x9iRv9dtTgK0pVUL0Gf/KaGD1buDG4hGxStHt/0+zCqsSoaOnBNjkmMSz6dymP/lapaxOtfyIiHvjc3vXeOsnzH70gHn2wXVIznW4x9CNnRBoqLQYzcfvlFmwFukV+yiYlMEvRu3c4xejbwnQaqq9JXkuNSbO1xs0iV3kChPcFbhjz7o8/V/YrqaavKNVDdVbVpCfFW/cEJZBZauUbuyJGsWFG0VVmSqQWb4MYxsSw7AZCm+8sDz20TbzpsYuinc/F5RWjH2iVRWb4tOxGXMW2Ci6vLAbxoYXP43DKAlJavHwNsoOID4i0lC4GmbGQHJE4QMMmqer1zE/L7AyV75NT6XlFUdYf1WnwS31pLCJ1+JtEBslOSTqks7ixyefEMDvdsguID0jKZUPnnZ/b4ZjOxhk9L+cod0xosxyXz0hvn5FzkjvfslO8+4mrxZhCZuHz2WKTtrFLEqBOjIih99QVK3un5PdQt0E8+woN0Hqe3I3fPXtout/tpOfJ3Xf2e1AUZc1RfZJOIS8G3Ncosk5Ju5+4Jp53qVlaKUhbyEGgTfri+BpnB3LvFJdHYgQjZ+VWKtyai69RZttODUvl7sjZohQUAp+R1MxkTHYodR3Tn1EoFHvmTMrrhex0gBYzPcrR4YaChUD9/CriOZSknVuaiqUoyrqketMyJ6LisbffI1r2xFXJiCnp6qXXA63FXvDBYvuEJdz0lHr0OD2zWymXo1CQXUhyTIz5jediEng1DjH4Lh83UjAdLrlupwtwyA7BOKRdQy4DmYnbCzwrirLuqb20TGuLYwAbReuOX5cWwyVjn4yJsffUi4EtVcUutVH0FadajZ6XLJy5Fb0zcTgkzz/YIi0cSu2Ogy2QnhKvvTRQ3ThFh3f5ASu7Gk8xoOsOyuKWTYiM07Bxab+Toijrluo0+MmxolTTKoa9kJvW5UvFVA5P0Xg6ZjdGW2q89cUMnHOi1TffdfOpUU53MRunDNbK9ynkpwuv3H7x+BOjMHpWnisVmSmKohSpzn1+YkSqTd0B0cb9TeIRFwqi21srBtLmxQBX8rqXCk9QMnOMs1hBO3rnn2VMMcjsk8/1BCQ9c+ScVPO6gzLxS429oihzqD4Pv1DsDBksavO2MCNwW5Q63AH5GdpaNkVxWXD7xOiPXRDDnIlLD57FDBfJJiUwnRoXPb9hk3xvbWusKEoZqs/gO5zQvke8+cETkqLo9otXnRiRdMVMXAKbMxudrQSlqtqJqOw8SvNxg223Z/hTE8V+/BOya6jfKJ+xXLKUoihVQfUZ/BKpmKQrBreIbj9+RYKcubTIPTMnXq0kxhRbIbdK1W98QG7uoASZPUHJ6nG65dh8rjgaMVEsKJuU7+VwSyuHYKsaekVRbonqNfjxATHwnjppWWAccivkpABptY2kyystFOo6ZHFKjc9o9lYB45QgsK9R4hIq3SiKchtUp8EvpTSGtooRzSakmCkVE6/4ZlkyK4nbB+4NMlAll5HrzmelAheKTdGcskC4A2rkFUW5Y6rT4MeHRPIA0bq9jcXeOvXzu1iuJVye5c8YUhSlZqm+tMxCXjRuXyOMXwVXQLxl4xAJRT1kRVFqlOoz+A6n5KFnEvLY5ZH+942bF5cCqSiKss6pPoMPkvaYS0jny1RMKm61EElRlBqn+gx+PgfJUTH26QlJcVxMu2NFUZQqYVEG3xjzC8aY48aYgjGmbHe24nEXjTHHjDFHjTGLmEp+CzhdIungkIyXxs2rn4KpKIqyBlhsls4bwEeAP76FY5+w1g4v8ny3Rj5bHFPYMn/MoKIoSo2yKINvrX0TwKylzBdri90wXTLdSlEURQFWTsO3wDeMMYeNMR9b6EBjzMeMMYeMMYeGhm4y17Xsmaz0zmncpFKOoijKDG7q4RtjvgVsKPPS71lrv3KL53nMWhsxxrQD3zTGnLTWfr/cgdbazwCfAZl4dYufP42jmG+vKIqizOKmBt9a+57FnsRaGyn+HDTGfBl4BChr8BVFUZTlYdklHWNM0BhTX7oPvA8J9iqKoigryGLTMn/OGHMVeBR4zhjzQvH5TmPM88XDOoAfGmNeA14FnrPW/t1izqsoiqLcPovN0vky8OUyz0eBDxTvnwceWMx5FEVRlMVTfZW2iqIoSlnU4CuKotQIavAVRVFqBDX4iqIoNYKx9vZrm1YKY8wQcGkJPqoVWJk+PiuDfp+1TbV9H6i+71TN32ertbat3EFr2uAvFcaYQ9bait081xv6fdY21fZ9oPq+U61+H5V0FEVRagQ1+IqiKDVCrRj8z6z2BSwx+n3WNtX2faD6vlNNfp+a0PAVRVGU2vHwFUVRah41+IqiKDVCTRh8Y8y/N8a8Xhyi/g1jTOdqX9NiMcb0GWNOFr/Xl40xodW+psVgjPkFY8xxY0zBGLNu0+WMMe83xpwyxpw1xnx8ta9nsRhjPmuMGTTGrPuW5saYzcaY7xhjThT/rf2z1b6mxWKM8RljXjXGvFb8Tp9a8Pha0PCNMQ3W2oni/d8B7rbW/pNVvqxFYYx5H/Bta23OGPOfAKy1/9cqX9YdY4zZCxSAPwb+T2vtoVW+pNvGGOMETgPvBa4CB4FfsdaeWNULWwTGmHcAceAvrLX3rvb1LAZjzEZgo7X2J8UZHYeB8Dr/+xggaK2NG2PcwA+Bf2atfbnc8TXh4ZeMfZEgMmN3XWOt/Ya1Nld8+DKwaTWvZ7FYa9+01p5a7etYJI8AZ6215621GeCvgQ+v8jUtiuIo0tHVvo6lwFp7zVr7k+L9SeBNoGt1r2pxWCFefOgu3irat5ow+ADGmP9gjLkC/Brwb1f7epaY3wS+vtoXodAFXJnx+Crr3KBUK8aYbcA+4JVVvpRFY4xxGmOOAoPAN621Fb9T1Rh8Y8y3jDFvlLl9GMBa+3vW2s3A54DfXt2rvTVu9p2Kx/wekEO+15rmVr6Poiw3xpg64Bngn8/Z/a9LrLV5a+2DyC7/EWNMReltUROv1hK3MWz9c8DzwCeW8XKWhJt9J2PMbwA/A7zbroNgzG38jdYrEWDzjMebis8pa4Sizv0M8Dlr7bOrfT1LibU2Zoz5DvB+KswNrxoPfyGMMTtnPPwwcHK1rmWpMMa8H/hXwIestYnVvh4FkCDtTmNMtzHGA/wy8NVVvialSDHA+afAm9ba/2e1r2cpMMa0lTL0jDF+JGGgon2rlSydZ4DdSBbIJeCfWGvXtedljDkLeIGR4lMvr+fMI2PMzwF/ALQBMeCotfbJVb2oO8AY8wHgvwJO4LPW2v+wule0OIwxnwceR9rvDgCfsNb+6ape1B1ijHkM+AFwDLEFAP/aWvv86l3V4jDG3A/8OfLvzQF8wVr77yoeXwsGX1EURakRSUdRFEVRg68oilIzqMFXFEWpEdTgK4qi1Ahq8BVFUWoENfiKoig1ghp8RVGUGuH/B4tiDH8qOIcJAAAAAElFTkSuQmCC\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d4276731",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "dd4e28b2",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-21T11:11:35.606994Z",
     "iopub.status.busy": "2022-07-21T11:11:35.606697Z",
     "iopub.status.idle": "2022-07-21T11:11:35.624408Z",
     "shell.execute_reply": "2022-07-21T11:11:35.623700Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "44fc356f",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "e2f19bd8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-21T11:11:35.669415Z",
     "iopub.status.busy": "2022-07-21T11:11:35.669062Z",
     "iopub.status.idle": "2022-07-21T11:11:35.673022Z",
     "shell.execute_reply": "2022-07-21T11:11:35.672380Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "3d2aa570",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-21T11:11:35.675752Z",
     "iopub.status.busy": "2022-07-21T11:11:35.675438Z",
     "iopub.status.idle": "2022-07-21T11:11:41.256167Z",
     "shell.execute_reply": "2022-07-21T11:11:41.255282Z"
    }
   },
   "outputs": [],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3b4c6f18",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9d009b1f",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "b2b0d8db",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-21T11:11:41.260662Z",
     "iopub.status.busy": "2022-07-21T11:11:41.260365Z",
     "iopub.status.idle": "2022-07-21T11:11:41.264890Z",
     "shell.execute_reply": "2022-07-21T11:11:41.264350Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "37e29bc0",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "3e9ac9ab",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-21T11:11:41.268188Z",
     "iopub.status.busy": "2022-07-21T11:11:41.267952Z",
     "iopub.status.idle": "2022-07-21T11:11:44.390942Z",
     "shell.execute_reply": "2022-07-21T11:11:44.390214Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0a26b64c",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a5e2d5aa",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "5d283550",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-21T11:11:44.394087Z",
     "iopub.status.busy": "2022-07-21T11:11:44.393787Z",
     "iopub.status.idle": "2022-07-21T11:11:44.409829Z",
     "shell.execute_reply": "2022-07-21T11:11:44.409186Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "2a8c4439",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-21T11:11:44.413088Z",
     "iopub.status.busy": "2022-07-21T11:11:44.412451Z",
     "iopub.status.idle": "2022-07-21T11:11:46.338034Z",
     "shell.execute_reply": "2022-07-21T11:11:46.337455Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889758\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735859e-04, -4.30340709e-04,  3.97830747e-04,  2.26009893e-06,\n",
       "        4.29147212e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005976,   1.74612938,   0.18194306, -15.21875416,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d099605a",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
