{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "b3f66dad",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "e6d62750",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T09:36:53.985234Z",
     "iopub.status.busy": "2022-07-06T09:36:53.984894Z",
     "iopub.status.idle": "2022-07-06T09:36:57.912113Z",
     "shell.execute_reply": "2022-07-06T09:36:57.911479Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-07-06 09:36:55.010141: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-07-06 09:36:55.010170: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.inheritance.inherit_check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import reduce_in_tests\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "db8f5d3c",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "ab5fec8e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T09:36:57.915914Z",
     "iopub.status.busy": "2022-07-06T09:36:57.915237Z",
     "iopub.status.idle": "2022-07-06T09:36:57.918881Z",
     "shell.execute_reply": "2022-07-06T09:36:57.918186Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9cc06ca4",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "c07ec634",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T09:36:57.921733Z",
     "iopub.status.busy": "2022-07-06T09:36:57.921456Z",
     "iopub.status.idle": "2022-07-06T09:36:57.924543Z",
     "shell.execute_reply": "2022-07-06T09:36:57.923991Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = reduce_in_tests(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "82bf0811",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T09:36:57.927184Z",
     "iopub.status.busy": "2022-07-06T09:36:57.926948Z",
     "iopub.status.idle": "2022-07-06T09:36:58.026626Z",
     "shell.execute_reply": "2022-07-06T09:36:58.025856Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7facfcf6f730>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "4740ce4f",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T09:36:58.029652Z",
     "iopub.status.busy": "2022-07-06T09:36:58.029362Z",
     "iopub.status.idle": "2022-07-06T09:36:58.116527Z",
     "shell.execute_reply": "2022-07-06T09:36:58.115739Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "2022-07-06 09:36:58.032260: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-07-06 09:36:58.032293: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-07-06 09:36:58.032314: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (969bb9a2a7db): /proc/driver/nvidia/version does not exist\n",
      "2022-07-06 09:36:58.032555: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7facfcfbff10&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value  </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0    </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]</td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0    </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.01   </td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7facfcfbff10>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤═════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value   │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪═════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0     │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.] │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0     │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.01    │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧═════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "3d2ffd85",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T09:36:58.119710Z",
     "iopub.status.busy": "2022-07-06T09:36:58.119424Z",
     "iopub.status.idle": "2022-07-06T09:36:58.441944Z",
     "shell.execute_reply": "2022-07-06T09:36:58.441328Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "56b21529",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "67dc886e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T09:36:58.444680Z",
     "iopub.status.busy": "2022-07-06T09:36:58.444393Z",
     "iopub.status.idle": "2022-07-06T09:36:58.460057Z",
     "shell.execute_reply": "2022-07-06T09:36:58.459431Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "78284b7e",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "89ab58dc",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T09:36:58.463067Z",
     "iopub.status.busy": "2022-07-06T09:36:58.462782Z",
     "iopub.status.idle": "2022-07-06T09:36:58.466434Z",
     "shell.execute_reply": "2022-07-06T09:36:58.465821Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "abacc965",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T09:36:58.468755Z",
     "iopub.status.busy": "2022-07-06T09:36:58.468494Z",
     "iopub.status.idle": "2022-07-06T09:37:05.616883Z",
     "shell.execute_reply": "2022-07-06T09:37:05.616196Z"
    }
   },
   "outputs": [],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "08a1fd8e",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fdcdb84c",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "9b2cd34d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T09:37:05.656199Z",
     "iopub.status.busy": "2022-07-06T09:37:05.655846Z",
     "iopub.status.idle": "2022-07-06T09:37:05.661000Z",
     "shell.execute_reply": "2022-07-06T09:37:05.660428Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e6f195f9",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "69b0eb28",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T09:37:05.663788Z",
     "iopub.status.busy": "2022-07-06T09:37:05.663512Z",
     "iopub.status.idle": "2022-07-06T09:37:07.910454Z",
     "shell.execute_reply": "2022-07-06T09:37:07.909751Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8cf47e7e",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "01d7de82",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "c49f1f6a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T09:37:07.913722Z",
     "iopub.status.busy": "2022-07-06T09:37:07.913420Z",
     "iopub.status.idle": "2022-07-06T09:37:07.931052Z",
     "shell.execute_reply": "2022-07-06T09:37:07.930322Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "a2c0d1ae",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T09:37:07.934106Z",
     "iopub.status.busy": "2022-07-06T09:37:07.933806Z",
     "iopub.status.idle": "2022-07-06T09:37:10.033333Z",
     "shell.execute_reply": "2022-07-06T09:37:10.032692Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889758\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735859e-04, -4.30340709e-04,  3.97830747e-04,  2.26009893e-06,\n",
       "        4.29147212e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005976,   1.74612938,   0.18194306, -15.21875416,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "05823d18",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
