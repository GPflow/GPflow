{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "9b46c41c",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "76e1497b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T11:03:59.852084Z",
     "iopub.status.busy": "2022-07-06T11:03:59.851655Z",
     "iopub.status.idle": "2022-07-06T11:04:03.960017Z",
     "shell.execute_reply": "2022-07-06T11:04:03.959357Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-07-06 11:04:00.962734: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-07-06 11:04:00.962767: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.inheritance.inherit_check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import reduce_in_tests\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "acc739d7",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "07354faf",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T11:04:03.963649Z",
     "iopub.status.busy": "2022-07-06T11:04:03.963132Z",
     "iopub.status.idle": "2022-07-06T11:04:03.966655Z",
     "shell.execute_reply": "2022-07-06T11:04:03.966079Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "75fa4d66",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "cfd4a8f0",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T11:04:03.969310Z",
     "iopub.status.busy": "2022-07-06T11:04:03.969013Z",
     "iopub.status.idle": "2022-07-06T11:04:03.972114Z",
     "shell.execute_reply": "2022-07-06T11:04:03.971616Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = reduce_in_tests(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "d34aa954",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T11:04:03.974492Z",
     "iopub.status.busy": "2022-07-06T11:04:03.974181Z",
     "iopub.status.idle": "2022-07-06T11:04:04.094295Z",
     "shell.execute_reply": "2022-07-06T11:04:04.093686Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f3dbb339510>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "f1329d16",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T11:04:04.096986Z",
     "iopub.status.busy": "2022-07-06T11:04:04.096678Z",
     "iopub.status.idle": "2022-07-06T11:04:04.293877Z",
     "shell.execute_reply": "2022-07-06T11:04:04.293161Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "2022-07-06 11:04:04.099569: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-07-06 11:04:04.099601: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-07-06 11:04:04.099621: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (3884e80d8d73): /proc/driver/nvidia/version does not exist\n",
      "2022-07-06 11:04:04.099867: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f3dbb36dd20&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value  </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0    </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]</td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0    </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.01   </td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f3dbb36dd20>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤═════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value   │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪═════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0     │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.] │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0     │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.01    │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧═════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "c688d97b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T11:04:04.296756Z",
     "iopub.status.busy": "2022-07-06T11:04:04.296402Z",
     "iopub.status.idle": "2022-07-06T11:04:04.453035Z",
     "shell.execute_reply": "2022-07-06T11:04:04.452428Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "299772cf",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "436a2790",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T11:04:04.456163Z",
     "iopub.status.busy": "2022-07-06T11:04:04.455864Z",
     "iopub.status.idle": "2022-07-06T11:04:04.502004Z",
     "shell.execute_reply": "2022-07-06T11:04:04.501326Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ba0b49a5",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "a7fc62c9",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T11:04:04.506061Z",
     "iopub.status.busy": "2022-07-06T11:04:04.505756Z",
     "iopub.status.idle": "2022-07-06T11:04:04.509633Z",
     "shell.execute_reply": "2022-07-06T11:04:04.509070Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "34ecd060",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T11:04:04.512883Z",
     "iopub.status.busy": "2022-07-06T11:04:04.512615Z",
     "iopub.status.idle": "2022-07-06T11:04:11.457217Z",
     "shell.execute_reply": "2022-07-06T11:04:11.456426Z"
    }
   },
   "outputs": [],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "34ccc066",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "be718a05",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "95112e88",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T11:04:11.500530Z",
     "iopub.status.busy": "2022-07-06T11:04:11.500119Z",
     "iopub.status.idle": "2022-07-06T11:04:11.506025Z",
     "shell.execute_reply": "2022-07-06T11:04:11.505402Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2e019f3d",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "242f6cf1",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T11:04:11.508839Z",
     "iopub.status.busy": "2022-07-06T11:04:11.508536Z",
     "iopub.status.idle": "2022-07-06T11:04:13.661990Z",
     "shell.execute_reply": "2022-07-06T11:04:13.661252Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "bcf6cb62",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "de1d66c9",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "63146dc1",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T11:04:13.665250Z",
     "iopub.status.busy": "2022-07-06T11:04:13.664928Z",
     "iopub.status.idle": "2022-07-06T11:04:13.683284Z",
     "shell.execute_reply": "2022-07-06T11:04:13.682605Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "67cf9d32",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T11:04:13.686361Z",
     "iopub.status.busy": "2022-07-06T11:04:13.686072Z",
     "iopub.status.idle": "2022-07-06T11:04:15.673597Z",
     "shell.execute_reply": "2022-07-06T11:04:15.672798Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889758\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735859e-04, -4.30340709e-04,  3.97830747e-04,  2.26009893e-06,\n",
       "        4.29147212e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005976,   1.74612938,   0.18194306, -15.21875416,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "df996ff8",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
