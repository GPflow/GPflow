{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "f82aa04f",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "63ee41cb",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T10:20:21.859267Z",
     "iopub.status.busy": "2022-07-06T10:20:21.858935Z",
     "iopub.status.idle": "2022-07-06T10:20:25.629397Z",
     "shell.execute_reply": "2022-07-06T10:20:25.628757Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-07-06 10:20:22.771574: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-07-06 10:20:22.771602: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.inheritance.inherit_check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import reduce_in_tests\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b0770624",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "c002e046",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T10:20:25.632794Z",
     "iopub.status.busy": "2022-07-06T10:20:25.632341Z",
     "iopub.status.idle": "2022-07-06T10:20:25.635529Z",
     "shell.execute_reply": "2022-07-06T10:20:25.635034Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dccf7e38",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "b01efab1",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T10:20:25.638019Z",
     "iopub.status.busy": "2022-07-06T10:20:25.637743Z",
     "iopub.status.idle": "2022-07-06T10:20:25.640683Z",
     "shell.execute_reply": "2022-07-06T10:20:25.640201Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = reduce_in_tests(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "a4383aec",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T10:20:25.643086Z",
     "iopub.status.busy": "2022-07-06T10:20:25.642834Z",
     "iopub.status.idle": "2022-07-06T10:20:25.735689Z",
     "shell.execute_reply": "2022-07-06T10:20:25.735121Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f205281d840>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "5f1ff033",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T10:20:25.738426Z",
     "iopub.status.busy": "2022-07-06T10:20:25.738143Z",
     "iopub.status.idle": "2022-07-06T10:20:25.817380Z",
     "shell.execute_reply": "2022-07-06T10:20:25.816765Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "2022-07-06 10:20:25.740578: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-07-06 10:20:25.740607: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-07-06 10:20:25.740626: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (2da3b94fca34): /proc/driver/nvidia/version does not exist\n",
      "2022-07-06 10:20:25.740859: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f2050602050&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value  </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0    </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]</td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0    </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.01   </td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f2050602050>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤═════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value   │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪═════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0     │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.] │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0     │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.01    │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧═════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "e918f849",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T10:20:25.819933Z",
     "iopub.status.busy": "2022-07-06T10:20:25.819645Z",
     "iopub.status.idle": "2022-07-06T10:20:26.125923Z",
     "shell.execute_reply": "2022-07-06T10:20:26.125310Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fa57adfc",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "192b6e8b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T10:20:26.128700Z",
     "iopub.status.busy": "2022-07-06T10:20:26.128412Z",
     "iopub.status.idle": "2022-07-06T10:20:26.143715Z",
     "shell.execute_reply": "2022-07-06T10:20:26.143170Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5dbf0280",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "f7f3c473",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T10:20:26.146498Z",
     "iopub.status.busy": "2022-07-06T10:20:26.146233Z",
     "iopub.status.idle": "2022-07-06T10:20:26.149685Z",
     "shell.execute_reply": "2022-07-06T10:20:26.149143Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "4f919064",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T10:20:26.151993Z",
     "iopub.status.busy": "2022-07-06T10:20:26.151760Z",
     "iopub.status.idle": "2022-07-06T10:20:32.760171Z",
     "shell.execute_reply": "2022-07-06T10:20:32.759532Z"
    }
   },
   "outputs": [],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9bc201f0",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dd58f53e",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "ec26ee74",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T10:20:32.783447Z",
     "iopub.status.busy": "2022-07-06T10:20:32.782829Z",
     "iopub.status.idle": "2022-07-06T10:20:32.789728Z",
     "shell.execute_reply": "2022-07-06T10:20:32.789200Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d17cfb86",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "55eec712",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T10:20:32.792314Z",
     "iopub.status.busy": "2022-07-06T10:20:32.792068Z",
     "iopub.status.idle": "2022-07-06T10:20:34.660127Z",
     "shell.execute_reply": "2022-07-06T10:20:34.659489Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4acde5b1",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "af86ca45",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "2210791f",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T10:20:34.663403Z",
     "iopub.status.busy": "2022-07-06T10:20:34.663125Z",
     "iopub.status.idle": "2022-07-06T10:20:34.695653Z",
     "shell.execute_reply": "2022-07-06T10:20:34.695093Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "bede1ce9",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-06T10:20:34.698507Z",
     "iopub.status.busy": "2022-07-06T10:20:34.698241Z",
     "iopub.status.idle": "2022-07-06T10:20:36.687519Z",
     "shell.execute_reply": "2022-07-06T10:20:36.686869Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889758\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735859e-04, -4.30340709e-04,  3.97830747e-04,  2.26009893e-06,\n",
       "        4.29147212e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005976,   1.74612938,   0.18194306, -15.21875416,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "37a846a6",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
