{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "b8e671ef",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "719681f9",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-05T10:49:50.165439Z",
     "iopub.status.busy": "2022-07-05T10:49:50.165158Z",
     "iopub.status.idle": "2022-07-05T10:49:53.658827Z",
     "shell.execute_reply": "2022-07-05T10:49:53.658156Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-07-05 10:49:51.092148: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-07-05 10:49:51.092174: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.inheritance.inherit_check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import reduce_in_tests\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d531b719",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "7227846a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-05T10:49:53.662018Z",
     "iopub.status.busy": "2022-07-05T10:49:53.661594Z",
     "iopub.status.idle": "2022-07-05T10:49:53.664643Z",
     "shell.execute_reply": "2022-07-05T10:49:53.664173Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a9479e18",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "daae6b04",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-05T10:49:53.667161Z",
     "iopub.status.busy": "2022-07-05T10:49:53.666842Z",
     "iopub.status.idle": "2022-07-05T10:49:53.669524Z",
     "shell.execute_reply": "2022-07-05T10:49:53.669063Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = reduce_in_tests(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "d6babfa8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-05T10:49:53.671858Z",
     "iopub.status.busy": "2022-07-05T10:49:53.671617Z",
     "iopub.status.idle": "2022-07-05T10:49:53.790973Z",
     "shell.execute_reply": "2022-07-05T10:49:53.790348Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f6fa39d1540>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "1ba43244",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-05T10:49:53.793617Z",
     "iopub.status.busy": "2022-07-05T10:49:53.793332Z",
     "iopub.status.idle": "2022-07-05T10:49:53.842950Z",
     "shell.execute_reply": "2022-07-05T10:49:53.842380Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "2022-07-05 10:49:53.796192: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-07-05 10:49:53.796218: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-07-05 10:49:53.796237: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (4edf0ada5b39): /proc/driver/nvidia/version does not exist\n",
      "2022-07-05 10:49:53.796480: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f6fa3a11d50&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value  </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0    </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]</td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0    </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.01   </td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f6fa3a11d50>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤═════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value   │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪═════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0     │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.] │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0     │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.01    │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧═════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "da8ff2a3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-05T10:49:53.845528Z",
     "iopub.status.busy": "2022-07-05T10:49:53.845253Z",
     "iopub.status.idle": "2022-07-05T10:49:54.024050Z",
     "shell.execute_reply": "2022-07-05T10:49:54.023480Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6eeeab9c",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "ec09dcd2",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-05T10:49:54.026873Z",
     "iopub.status.busy": "2022-07-05T10:49:54.026602Z",
     "iopub.status.idle": "2022-07-05T10:49:54.041818Z",
     "shell.execute_reply": "2022-07-05T10:49:54.041258Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ed2049f9",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "90fff7a2",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-05T10:49:54.044684Z",
     "iopub.status.busy": "2022-07-05T10:49:54.044427Z",
     "iopub.status.idle": "2022-07-05T10:49:54.047859Z",
     "shell.execute_reply": "2022-07-05T10:49:54.047365Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "076ddc9f",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-05T10:49:54.050282Z",
     "iopub.status.busy": "2022-07-05T10:49:54.050038Z",
     "iopub.status.idle": "2022-07-05T10:50:00.444691Z",
     "shell.execute_reply": "2022-07-05T10:50:00.444056Z"
    }
   },
   "outputs": [],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d165ee8d",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2df44ed6",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "3ab56aed",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-05T10:50:00.476221Z",
     "iopub.status.busy": "2022-07-05T10:50:00.475891Z",
     "iopub.status.idle": "2022-07-05T10:50:00.480920Z",
     "shell.execute_reply": "2022-07-05T10:50:00.480361Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d930f3f2",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "8a1a51f9",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-05T10:50:00.483905Z",
     "iopub.status.busy": "2022-07-05T10:50:00.483652Z",
     "iopub.status.idle": "2022-07-05T10:50:02.326145Z",
     "shell.execute_reply": "2022-07-05T10:50:02.325493Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "44dabd19",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cf0be950",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "f0ae50e5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-05T10:50:02.329236Z",
     "iopub.status.busy": "2022-07-05T10:50:02.328957Z",
     "iopub.status.idle": "2022-07-05T10:50:02.345802Z",
     "shell.execute_reply": "2022-07-05T10:50:02.345107Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "742320a3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-05T10:50:02.348992Z",
     "iopub.status.busy": "2022-07-05T10:50:02.348717Z",
     "iopub.status.idle": "2022-07-05T10:50:04.335590Z",
     "shell.execute_reply": "2022-07-05T10:50:04.335023Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889758\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735859e-04, -4.30340709e-04,  3.97830747e-04,  2.26009893e-06,\n",
       "        4.29147212e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005976,   1.74612938,   0.18194306, -15.21875416,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "a9b04950",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
