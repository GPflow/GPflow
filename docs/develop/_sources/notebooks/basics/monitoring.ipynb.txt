{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "7cade17b",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "084f2f44",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-04T10:18:08.869321Z",
     "iopub.status.busy": "2022-07-04T10:18:08.869004Z",
     "iopub.status.idle": "2022-07-04T10:18:12.580255Z",
     "shell.execute_reply": "2022-07-04T10:18:12.579599Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-07-04 10:18:09.839660: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-07-04 10:18:09.839688: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.inheritance.inherit_check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import reduce_in_tests\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b7eccaa2",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "4b49f288",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-04T10:18:12.583594Z",
     "iopub.status.busy": "2022-07-04T10:18:12.583134Z",
     "iopub.status.idle": "2022-07-04T10:18:12.586326Z",
     "shell.execute_reply": "2022-07-04T10:18:12.585792Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "bce83d7b",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "83bf7b94",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-04T10:18:12.588788Z",
     "iopub.status.busy": "2022-07-04T10:18:12.588537Z",
     "iopub.status.idle": "2022-07-04T10:18:12.591452Z",
     "shell.execute_reply": "2022-07-04T10:18:12.590939Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = reduce_in_tests(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "204630cb",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-04T10:18:12.593820Z",
     "iopub.status.busy": "2022-07-04T10:18:12.593572Z",
     "iopub.status.idle": "2022-07-04T10:18:12.706319Z",
     "shell.execute_reply": "2022-07-04T10:18:12.705745Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f444db753f0>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "dafecf04",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-04T10:18:12.708958Z",
     "iopub.status.busy": "2022-07-04T10:18:12.708687Z",
     "iopub.status.idle": "2022-07-04T10:18:12.761722Z",
     "shell.execute_reply": "2022-07-04T10:18:12.761113Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "2022-07-04 10:18:12.711497: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-07-04 10:18:12.711532: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-07-04 10:18:12.711554: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (f028043d2f5a): /proc/driver/nvidia/version does not exist\n",
      "2022-07-04 10:18:12.711787: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f444dbb9b70&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f444dbb9b70>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "ea3879c8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-04T10:18:12.764396Z",
     "iopub.status.busy": "2022-07-04T10:18:12.764100Z",
     "iopub.status.idle": "2022-07-04T10:18:12.904699Z",
     "shell.execute_reply": "2022-07-04T10:18:12.904061Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c471aa4e",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "e1641055",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-04T10:18:12.908737Z",
     "iopub.status.busy": "2022-07-04T10:18:12.908420Z",
     "iopub.status.idle": "2022-07-04T10:18:12.925095Z",
     "shell.execute_reply": "2022-07-04T10:18:12.924465Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b4690105",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "98f55be1",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-04T10:18:12.929256Z",
     "iopub.status.busy": "2022-07-04T10:18:12.928953Z",
     "iopub.status.idle": "2022-07-04T10:18:12.932577Z",
     "shell.execute_reply": "2022-07-04T10:18:12.932043Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "c2f776db",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-04T10:18:12.934849Z",
     "iopub.status.busy": "2022-07-04T10:18:12.934596Z",
     "iopub.status.idle": "2022-07-04T10:18:19.753217Z",
     "shell.execute_reply": "2022-07-04T10:18:19.752416Z"
    }
   },
   "outputs": [],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ba580bf4",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "65b2d8ef",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "a2d29f56",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-04T10:18:19.800906Z",
     "iopub.status.busy": "2022-07-04T10:18:19.800551Z",
     "iopub.status.idle": "2022-07-04T10:18:19.805566Z",
     "shell.execute_reply": "2022-07-04T10:18:19.805015Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "083152fc",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "df39b2d4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-04T10:18:19.808204Z",
     "iopub.status.busy": "2022-07-04T10:18:19.807928Z",
     "iopub.status.idle": "2022-07-04T10:18:21.695444Z",
     "shell.execute_reply": "2022-07-04T10:18:21.694710Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e7d029fc",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e579dc7a",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "1c4d152c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-04T10:18:21.699158Z",
     "iopub.status.busy": "2022-07-04T10:18:21.698780Z",
     "iopub.status.idle": "2022-07-04T10:18:21.715452Z",
     "shell.execute_reply": "2022-07-04T10:18:21.714367Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "e05ecb07",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-04T10:18:21.718458Z",
     "iopub.status.busy": "2022-07-04T10:18:21.718135Z",
     "iopub.status.idle": "2022-07-04T10:18:23.977096Z",
     "shell.execute_reply": "2022-07-04T10:18:23.976295Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889758\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735859e-04, -4.30340709e-04,  3.97830747e-04,  2.26009893e-06,\n",
       "        4.29147212e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005976,   1.74612938,   0.18194306, -15.21875416,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "44cb05b0",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
