{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "6a591ae7",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "06a8cf81",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-14T12:03:42.379757Z",
     "iopub.status.busy": "2022-07-14T12:03:42.379284Z",
     "iopub.status.idle": "2022-07-14T12:03:46.604673Z",
     "shell.execute_reply": "2022-07-14T12:03:46.604049Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-07-14 12:03:43.353930: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-07-14 12:03:43.353965: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.inheritance.inherit_check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import reduce_in_tests\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2d027c3f",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "fe37ab3e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-14T12:03:46.607906Z",
     "iopub.status.busy": "2022-07-14T12:03:46.607485Z",
     "iopub.status.idle": "2022-07-14T12:03:46.610768Z",
     "shell.execute_reply": "2022-07-14T12:03:46.610284Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d7448441",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "63a8cefa",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-14T12:03:46.613008Z",
     "iopub.status.busy": "2022-07-14T12:03:46.612759Z",
     "iopub.status.idle": "2022-07-14T12:03:46.615562Z",
     "shell.execute_reply": "2022-07-14T12:03:46.615090Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = reduce_in_tests(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "b636577e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-14T12:03:46.617888Z",
     "iopub.status.busy": "2022-07-14T12:03:46.617521Z",
     "iopub.status.idle": "2022-07-14T12:03:46.707216Z",
     "shell.execute_reply": "2022-07-14T12:03:46.706660Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7fa1c27c95d0>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "0689e6a7",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-14T12:03:46.709819Z",
     "iopub.status.busy": "2022-07-14T12:03:46.709552Z",
     "iopub.status.idle": "2022-07-14T12:03:46.792603Z",
     "shell.execute_reply": "2022-07-14T12:03:46.791804Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "2022-07-14 12:03:46.711960: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-07-14 12:03:46.711986: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-07-14 12:03:46.712005: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (c602e2d82b89): /proc/driver/nvidia/version does not exist\n",
      "2022-07-14 12:03:46.712257: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7fa1c2819e70&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value  </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0    </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]</td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0    </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.01   </td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7fa1c2819e70>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤═════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value   │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪═════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0     │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.] │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0     │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼─────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.01    │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧═════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "f4649e36",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-14T12:03:46.795316Z",
     "iopub.status.busy": "2022-07-14T12:03:46.795045Z",
     "iopub.status.idle": "2022-07-14T12:03:46.956469Z",
     "shell.execute_reply": "2022-07-14T12:03:46.955889Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5b240a06",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "82afbcab",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-14T12:03:46.959200Z",
     "iopub.status.busy": "2022-07-14T12:03:46.958924Z",
     "iopub.status.idle": "2022-07-14T12:03:46.973732Z",
     "shell.execute_reply": "2022-07-14T12:03:46.973175Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "91eea94e",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "a23dd3f8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-14T12:03:47.006690Z",
     "iopub.status.busy": "2022-07-14T12:03:47.006392Z",
     "iopub.status.idle": "2022-07-14T12:03:47.010367Z",
     "shell.execute_reply": "2022-07-14T12:03:47.009664Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "821b8ed2",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-14T12:03:47.012780Z",
     "iopub.status.busy": "2022-07-14T12:03:47.012534Z",
     "iopub.status.idle": "2022-07-14T12:03:52.271906Z",
     "shell.execute_reply": "2022-07-14T12:03:52.271256Z"
    }
   },
   "outputs": [],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8f326119",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "28709d57",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "1ccaa785",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-14T12:03:52.275177Z",
     "iopub.status.busy": "2022-07-14T12:03:52.274889Z",
     "iopub.status.idle": "2022-07-14T12:03:52.279513Z",
     "shell.execute_reply": "2022-07-14T12:03:52.278978Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "bcef1a69",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "1191037c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-14T12:03:52.282152Z",
     "iopub.status.busy": "2022-07-14T12:03:52.281894Z",
     "iopub.status.idle": "2022-07-14T12:03:55.284976Z",
     "shell.execute_reply": "2022-07-14T12:03:55.284350Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a55c06b3",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a7657bec",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "22f41337",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-14T12:03:55.287958Z",
     "iopub.status.busy": "2022-07-14T12:03:55.287690Z",
     "iopub.status.idle": "2022-07-14T12:03:55.302562Z",
     "shell.execute_reply": "2022-07-14T12:03:55.302060Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "22f9ca0a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-14T12:03:55.304993Z",
     "iopub.status.busy": "2022-07-14T12:03:55.304746Z",
     "iopub.status.idle": "2022-07-14T12:03:57.114436Z",
     "shell.execute_reply": "2022-07-14T12:03:57.113877Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889758\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735859e-04, -4.30340709e-04,  3.97830747e-04,  2.26009893e-06,\n",
       "        4.29147212e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005976,   1.74612938,   0.18194306, -15.21875416,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "5ef4cf00",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
